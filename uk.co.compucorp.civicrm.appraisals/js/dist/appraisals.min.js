/**
 * State-based routing for AngularJS
 * @version v0.2.15
 * @link http://angular-ui.github.com/
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

define("appraisals/utils/routes",[],function(){return function(e,t){e.otherwise("/dashboard"),t.state("appraisals",{"abstract":!0,template:"<ui-view/>",resolve:{format:["DateFormat",function(e){return e.getDateFormat()}],statuses:["AppraisalCycle",function(e){return e.statuses()}],types:["AppraisalCycle",function(e){return e.types()}]}}).state("appraisals.dashboard",{url:"/dashboard",controller:"AppraisalsDashboardCtrl",controllerAs:"dashboard",templateUrl:CRM.vars.appraisals.baseURL+"/views/dashboard.html",resolve:{activeCycles:["AppraisalCycle",function(e){return e.active()}],totalCycles:["AppraisalCycle",function(e){return e.total()}],statusOverview:["AppraisalCycle",function(e){return e.statusOverview()}]}}).state("appraisals.appraisal-cycle",{"abstract":!0,url:"/appraisal-cycle/:cycleId",controller:"AppraisalCycleCtrl",controllerAs:"cycle",templateUrl:CRM.vars.appraisals.baseURL+"/views/appraisal-cycle.html"}).state("appraisals.appraisal-cycle.cycle-summary",{url:"/cycle-summary",controller:"AppraisalCycleSummaryCtrl",controllerAs:"cycleSummary",templateUrl:CRM.vars.appraisals.baseURL+"/views/appraisal-cycle/cycle-summary.html"}).state("appraisals.appraisal-cycle.appraisals-in-cycle",{url:"/appraisals-in-cycle",controller:"AppraisalCycleAppraisalsCtrl",controllerAs:"cycleAppraisals",templateUrl:CRM.vars.appraisals.baseURL+"/views/appraisal-cycle/appraisals-in-cycle.html",resolve:{departments:["OptionGroup",function(e){return e.valuesOf("hrjc_department")}],levels:["OptionGroup",function(e){return e.valuesOf("hrjc_level_type")}],locations:["OptionGroup",function(e){return e.valuesOf("hrjc_location")}],regions:["OptionGroup",function(e){return e.valuesOf("hrjc_region")}]}}).state("appraisals.profile",{url:"/profile",templateUrl:CRM.vars.appraisals.baseURL+"/views/profile.html"}).state("appraisals.import",{url:"/import",templateUrl:CRM.vars.appraisals.baseURL+"/views/import.html"})}}),define("appraisals/modules/controllers",["common/angular"],function(e){return e.module("appraisals.controllers",[])}),define("appraisals/controllers/appraisals-ctrl",["appraisals/modules/controllers"],function(e){"use strict";e.controller("AppraisalsCtrl",["$log","$rootElement","$modal","AppraisalCycle",function(e,t,n,r){return e.debug("AppraisalsCtrl"),{openAppraisalCycleModal:function(){n.open({targetDomEl:t.children().eq(0),controller:"AppraisalCycleModalCtrl",controllerAs:"modal",bindToController:!0,templateUrl:CRM.vars.appraisals.baseURL+"/views/modals/appraisal-cycle.html"})}}}])}),define("appraisals/modules/models-instances",["common/angular","common/models/instances/instance"],function(e){"use strict";return e.module("appraisals.models.instances",["common.models.instances"])}),define("appraisals/modules/models",["common/angular","common/modules/models","common/modules/apis","common/mocks/module","appraisals/modules/models-instances"],function(e){"use strict";return e.module("appraisals.models",["common.models","common.apis","common.mocks","appraisals.models.instances"])}),define("appraisals/models/appraisal-cycle",["common/lodash","common/moment","appraisals/modules/models","common/models/model","common/services/api/appraisal-cycle"],function(e,t,n){"use strict";n.factory("AppraisalCycle",["Model","api.appraisal-cycle","AppraisalCycleInstance",function(n,r,i){return n.extend({active:function(){return r.total({cycle_is_active:!0})},all:function(e,t){return r.all(this.processFilters(e),t).then(function(e){return e.list=e.list.map(function(e){return i.init(e,!0)}),e})},create:function(e){var t=i.init(e).toAPI();return r.create(t).then(function(e){return i.init(e,!0)})},find:function(e){return r.find(e).then(function(e){return i.init(e,!0)})},grades:function(){return r.grades()},statuses:function(){return r.statuses().then(function(t){return t.map(function(t){return e.pick(t,["value","label"])})})},statusOverview:function(n){return r.statusOverview(e.defaults(n||{},{current_date:t().format("YYYY-MM-DD")})).then(function(t){return{steps:e.reduce(t,function(e,t){return e[t.status_id]={name:t.status_name,due:t.contacts_count.due,overdue:t.contacts_count.overdue},e},{}),totalAppraisalsNumber:e.reduce(t,function(e,t){return e+t.contacts_count.due+t.contacts_count.overdue},0)}})},total:function(){return r.total()},types:function(){return r.types().then(function(t){return t.map(function(t){return e.pick(t,["value","label"])})})}})}])}),define("appraisals/controllers/appraisals-dashboard-ctrl",["common/angular","common/moment","appraisals/modules/controllers","appraisals/models/appraisal-cycle"],function(e,t,n){"use strict";n.controller("AppraisalsDashboardCtrl",["$filter","$log","$modal","$rootElement","$rootScope","$scope","$timeout","AppraisalCycle","activeCycles","HR_settings","totalCycles","statusOverview","statuses","types",function(n,r,i,s,o,u,a,f,l,c,h,p,d,v){function g(){o.$on("AppraisalCycle::new",function(e,t){m.cycles.list.unshift(t)}),o.$on("AppraisalCycle::edit",function(e,t){var n,r;for(n=0,r=m.cycles.list.length;n<r;n++)if(m.cycles.list[n].id===t.id)break;m.cycles.list.splice(n,1,t)})}function y(){var t=e.copy(m.filters);return t.cycle_is_active===null&&delete t.cycle_is_active,Object.keys(t).filter(function(e){return _.endsWith(e,"_date")||_.endsWith(e,"_due")}).forEach(function(e){t[e].from=n("date")(t[e].from,c.DATE_FORMAT),t[e].to=n("date")(t[e].to,c.DATE_FORMAT)}),t}function b(e){var n=t();return f.statusOverview({cycles_ids:e,start_date:n.startOf("isoWeek").format("YYYY-MM-DD"),end_date:n.endOf("isoWeek").format("YYYY-MM-DD")})}function w(){g(),x(),m.requestCycles()}function E(e,t){t?e.list.forEach(function(e){m.cycles.list.push(e)}):m.cycles.list=e.list,m.cycles.total=e.total,m.loading.done=m.cycles.list.length===e.total}function S(e){m.appraisalsWeeklyFigures=_.reduce(e.steps,function(e,t){return e.due+=t.due,e.overdue+=t.overdue,e},{due:0,overdue:0})}function x(){var e=null;u.$watch(function(){return m.filters},function(t,n){t!==n&&(a.cancel(e),e=a(m.requestCycles,500))},!0)}r.debug("AppraisalsDashboardCtrl");var m={};return m.activeFilters=[{label:"active",value:!0},{label:"inactive",value:!1},{label:"all",value:null}],m.appraisalsWeeklyFigures={due:0,overdue:0},m.cycles={list:[],total:0},m.filtersCollapsed=!0,m.filters={cycle_is_active:m.activeFilters[0].value},m.loading={done:!1,inProgress:!1},m.pagination={page:1,size:5},m.activeCycles=l,m.totalCycles=h,m.statusOverview=p,m.statuses=d,m.types=v,m.changeActiveFilter=function(e){e=m.activeFilters.filter(function(t){return t.label===e})[0],typeof e!="undefined"&&m.filters.cycle_is_active!==e.value&&(m.filters.cycle_is_active=e.value,m.requestCycles())},m.editCycle=function(e){var t=o.$new();t.cycleId=e,i.open({targetDomEl:s.children().eq(0),controller:"AppraisalCycleModalCtrl",controllerAs:"modal",bindToController:!0,scope:t,templateUrl:CRM.vars.appraisals.baseURL+"/views/modals/appraisal-cycle.html"})},m.requestCycles=function(e){var t;if(e&&m.loading.done)return;m.loading.inProgress=!0,m.pagination.page=e?m.pagination.page+1:1,f.all(y(),m.pagination).then(function(n){return t=n,e?null:b(t.allIds)}).then(function(n){!!n&&S(n),E(t,e)}).then(function(){m.loading.inProgress=!1})},w(),m}])}),define("appraisals/controllers/appraisal-cycle-ctrl",["common/lodash","appraisals/modules/controllers","appraisals/models/appraisal-cycle"],function(e,t){"use strict";t.controller("AppraisalCycleCtrl",["$log","$modal","$rootElement","$rootScope","$stateParams","$timeout","AppraisalCycle","dialog","statuses","types",function(t,n,r,i,s,o,u,a,f,l){function p(){i.$on("AppraisalCycle::edit",function(t,n){e.assign(c.cycle,n),d()})}function d(){h=c.cycle.attributes()}function v(){p(),g()}function m(t){return n.open(e.assign({targetDomEl:r.children().eq(0),controller:t.controller,controllerAs:"modal",bindToController:!0,scope:function(t){var n=i.$new();return e.assign(n,t),n}(t.scopeData),windowClass:t.windowClass||null,templateUrl:CRM.vars.appraisals.baseURL+"/views/modals/"+t.templateFile}))}function g(){u.find(s.cycleId).then(function(e){return c.cycle=e,c.loading.cycle=!1,c.cycle.loadAppraisals({overdue:!0})}).then(function(){d(),c.loading.appraisals=!1})}t.debug("AppraisalCycleCtrl");var c={},h={};return c.cycle={},c.loading={cycle:!0,appraisals:!0},c.statuses=f,c.types=l,c.delete=function(){a.open({title:"Confirm Delete Appraisal",copyCancel:"Cancel",copyConfirm:"Delete",classConfirm:"btn-danger-outline",msg:"This cannot be undone"})},c.openAccessSettingsModal=function(){m({controller:"AccessSettingsModalCtrl",templateFile:"access-settings.html"})},c.openAddContactsModal=function(){m({controller:"AddContactsModalCtrl",templateFile:"add-contacts.html",scopeData:{cycleId:c.cycle.id}})},c.openViewCycleModal=function(){m({controller:"ViewCycleModalCtrl",templateFile:"view-cycle.html"})},c.openSendNotificationReminderModal=function(){m({controller:"SendNotificationReminderModalCtrl",windowClass:"modal--send-notification-reminder",templateFile:"send-notification-reminder.html"})},c.update=function(){a.open({title:"Confirm Cycle Update",copyCancel:null,copyConfirm:"Proceed",msg:"This will update the data of the cycle"}).then(function(t){t?(c.cycle.update(),d()):e.assign(c.cycle,h)})},v(),c}])}),define("appraisals/controllers/appraisal-cycle-appraisals-ctrl",["common/lodash","appraisals/modules/controllers","appraisals/models/appraisal-cycle"],function(e,t){"use strict";t.controller("AppraisalCycleAppraisalsCtrl",["$log","$scope","departments","levels","locations","regions",function(e,t,n,r,i,s){function u(){t.cycle.cycle.loadAppraisals().then(function(){o.loading.appraisals=!1})}e.debug("AppraisalCycleAppraisalsCtrl");var o={};return o.filtersCollapsed=!0,o.departments=n,o.levels=r,o.locations=i,o.regions=s,o.loading={appraisals:!0},t.$watch("cycle.loading.cycle",function(e){!e&&u()}),o}])}),define("appraisals/controllers/appraisal-cycle-summary-ctrl",["common/lodash","appraisals/modules/controllers"],function(e,t){"use strict";t.controller("AppraisalCycleSummaryCtrl",["$log","$modal","$rootElement","$rootScope","$scope","$timeout",function(t,n,r,i,s,o){function a(t){return n.open(e.assign({targetDomEl:r.children().eq(0),controller:t.controller,controllerAs:"modal",bindToController:!0,scope:function(t){var n=i.$new();return e.assign(n,t),n}(t.scopeData),windowClass:t.windowClass||null,templateUrl:CRM.vars.appraisals.baseURL+"/views/modals/"+t.templateFile}))}t.debug("AppraisalCycleSummaryCtrl");var u={};return u.picker={opened:!1},u.grades=[{label:"Value #1",value:10},{label:"Value #2",value:20},{label:"Value #3",value:30},{label:"Value #4",value:40}],u.toggleCalendar=function(){o(function(){u.picker.opened=!u.picker.opened})},u.openEditDatesModal=function(){a({controller:"EditDatesModalCtrl",templateFile:"edit-dates.html",scopeData:{cycle:s.cycle.cycle}})},u}])}),define("appraisals/controllers/modals/basic-modal-ctrl",["appraisals/modules/controllers"],function(e){e.controller("BasicModalCtrl",["$log","$modalInstance",function(e,t){return e.debug("BasicModalCtrl"),{cancel:function(){t.dismiss("cancel")}}}])}),define("appraisals/controllers/modals/appraisal-cycle-modal-ctrl",["common/lodash","common/moment","appraisals/modules/controllers"],function(e,t,n){"use strict";n.controller("AppraisalCycleModalCtrl",["$filter","$log","$rootScope","$scope","$controller","$modalInstance","AppraisalCycle","HR_settings","dialog",function(n,r,i,s,o,u,a,f,l){function p(){a.create(c.cycle).then(function(e){i.$emit("AppraisalCycle::new",e),u.close()})}function d(){c.cycle.update().then(function(){i.$emit("AppraisalCycle::edit",c.cycle),u.close()})}function v(){for(var t in c.cycle)if(e.endsWith(t,"_date")||e.endsWith(t,"_due"))c.cycle[t]=n("date")(c.cycle[t],f.DATE_FORMAT)}function m(){return e(c.form).omit(function(t,n){return e.startsWith(n,"$")}).transform(function(t,n,r){return t[r]=e.omit(n.$error,function(e){return!e}),t},{}).omit(function(t){return e.isEmpty(t)}).value()}function g(){return!e.isEqual(h,c.cycle.dueDates())}function y(){a.types().then(function(e){c.types=e,c.loaded.types=!0}),s.cycleId&&(c.edit=!0,a.find(s.cycleId).then(function(e){h=e.dueDates(),c.cycle=e,c.loaded.cycle=!0}))}function b(){var e=f.DATE_FORMAT.toUpperCase(),n=t(c.cycle.cycle_start_date,e),r=t(c.cycle.cycle_end_date,e),i=t(c.cycle.cycle_self_appraisal_due,e),s=t(c.cycle.cycle_manager_appraisal_due,e),o=t(c.cycle.cycle_grade_due,e);return c.form.cycle_end_date.$setValidity("isAfter",r.isAfter(n)),c.form.cycle_manager_appraisal_due.$setValidity("isAfter",s.isAfter(i)),c.form.cycle_grade_due.$setValidity("isAfter",o.isAfter(s)),c.form.$valid}function w(){return l.open({title:"Confirm Change Dates",copyCancel:"Cancel",copyConfirm:"Proceed",msg:"This will update the due dates for all appraisals in the cycle"})}r.debug("AppraisalCycleModalCtrl");var c=Object.create(o("BasicModalCtrl",{$modalInstance:u})),h={};return c.cycle={},c.types=[],c.edit=!1,c.formErrors={},c.formSubmitted=!1,c.loaded={types:!1,cycle:!s.cycleId},c.submit=function(){c.formSubmitted=!0,v();if(!b()){c.formErrors=m();return}c.edit?g()?w().then(function(e){!!e&&d()}):d():p()},y(),c}])}),define("appraisals/controllers/modals/access-settings-modal-ctrl",["appraisals/modules/controllers"],function(e){"use strict";e.controller("AccessSettingsModalCtrl",["$log","$controller","$modalInstance",function(e,t,n){e.debug("AccessSettingsModalCtrl");var r=Object.create(t("BasicModalCtrl",{$modalInstance:n}));return r}])}),define("appraisals/controllers/modals/edit-dates-modal-ctrl",["common/angular","appraisals/modules/controllers"],function(e,t){"use strict";t.controller("EditDatesModalCtrl",["$filter","$log","$rootScope","$scope","$controller","$modalInstance","HR_settings","dialog",function(t,n,r,i,s,o,u,a){function c(){Object.keys(f.cycle.dueDates()).forEach(function(e){f.cycle[e]=t("date")(f.cycle[e],u.DATE_FORMAT)})}function h(){return _(f.form).omit(function(e,t){return _.startsWith(t,"$")}).transform(function(e,t,n){return e[n]=_.omit(t.$error,function(e){return!e}),e},{}).omit(function(e){return _.isEmpty(e)}).value()}function p(){return!_.isEqual(l,f.cycle.dueDates())}function d(){l=f.cycle.dueDates()}function v(){return a.open({title:"Confirm Change Dates",copyCancel:"Cancel",copyConfirm:"Proceed",msg:"This will update the due dates for all appraisals in the cycle"})}function m(){f.cycle.update().then(function(){r.$emit("AppraisalCycle::edit",f.cycle),o.close()})}n.debug("EditDatesModalCtrl");var f=Object.create(s("BasicModalCtrl",{$modalInstance:o})),l={};return f.cycle=e.copy(i.cycle),f.formErrors={},f.formSubmitted=!1,f.submit=function(){f.formSubmitted=!0,c();if(!f.form.$valid){f.formErrors=h();return}p()?v().then(function(e){!!e&&m()}):m()},d(),f}])}),define("appraisals/controllers/modals/add-contacts-modal-ctrl",["appraisals/modules/controllers","common/models/contact","common/models/group","common/models/option-group"],function(e){"use strict";e.controller("AddContactsModalCtrl",["$q","$log","$controller","$modalInstance","$rootScope","$scope","$state","Appraisal","Contact","Group","OptionGroup",function(e,t,n,r,i,s,o,u,a,f,l){function h(){f.all().then(function(e){c.loading.groups=!1,c.groups=e.list}),l.valuesOf(["hrjc_department","hrjc_region","hrjc_location","hrjc_level_type"]).then(function(e){c.loading.optionValues=!1,c.optionValues=e})}t.debug("AddContactsModalCtrl");var c=Object.create(n("BasicModalCtrl",{$modalInstance:r}));return c.confirmScreen=!1,c.groups=[],c.criteria={},c.optionValues={},c.contacts={lookedUp:[],matching:[]},c.loading={addingContacts:!1,groups:!0,matchingContacts:!1,optionValues:!0},c.addContacts=function(){c.loading.addingContacts=!0,e.all(c.contacts.matching.map(function(e){return u.create({appraisal_cycle_id:s.cycleId,contact_id:e.id})})).then(function(e){i.$emit("Appraisal::new",e),r.close(),o.go("appraisals.appraisal-cycle.appraisals-in-cycle",{cycleId:s.cycleId})})},c.fetchContacts=function(){var t=_.clone(c.criteria),n=[];c.confirmScreen=!0,c.loading.matchingContacts=!0,t.contact_id&&(n.push(a.find(t.contact_id).then(function(e){return[e]})),t=_.omit(t,"contact_id")),_.isEmpty(t)||n.push(a.all(t).then(function(e){return e.list})),e.all(n).then(function(e){c.contacts.matching=_(e).flatten().uniq().value(),c.loading.matchingContacts=!1})},c.lookupContact=function(e){if(!e)return;a.all({display_name:e}).then(function(e){c.contacts.lookedUp=e})},c.resetSearch=function(){c.criteria={},c.contacts.matching=[],c.confirmScreen=!1},h(),c}])}),define("appraisals/controllers/modals/view-cycle-modal-ctrl",["appraisals/modules/controllers"],function(e){"use strict";e.controller("ViewCycleModalCtrl",["$log","$controller","$modalInstance",function(e,t,n){e.debug("ViewCycleModalCtrl");var r=Object.create(t("BasicModalCtrl",{$modalInstance:n}));return r}])}),define("appraisals/controllers/modals/send-notification-reminder-modal-ctrl",["appraisals/modules/controllers"],function(e){"use strict";e.controller("SendNotificationReminderModalCtrl",["$log","$controller","$modal","$modalInstance","$rootElement",function(e,t,n,r,i){e.debug("SendNotificationReminderModalCtrl");var s=Object.create(t("BasicModalCtrl",{$modalInstance:r}));return s.openNotificationRecipientsModal=function(){n.open({targetDomEl:i.children().eq(0),controller:"NotificationRecipientsModalCtrl",controllerAs:"modal",bindToController:!0,templateUrl:CRM.vars.appraisals.baseURL+"/views/modals/notification-recipients.html"})},s}])}),define("appraisals/controllers/modals/notification-recipients-modal-ctrl",["appraisals/modules/controllers"],function(e){"use strict";e.controller("NotificationRecipientsModalCtrl",["$log","$controller","$modalInstance",function(e,t,n){e.debug("NotificationRecipientsModalCtrl");var r=Object.create(t("BasicModalCtrl",{$modalInstance:n}));return r}])}),define("appraisals/modules/directives",["common/angular"],function(e){return e.module("appraisals.directives",[])}),define("appraisals/directives/show-more",["appraisals/modules/directives"],function(e){e.directive("crmShowMore",["$log",function(e){function t(t){typeof t.callback=="undefined"&&e.error("[callback] is mandatory"),typeof t.done=="undefined"&&e.error("[done] is mandatory")}return{scope:{callback:"&",done:"="},transclude:!0,replace:!0,templateUrl:CRM.vars.appraisals.baseURL+"/views/directives/show-more.html",controllerAs:"showMore",controller:["$scope",function(t){e.debug("crmShowMore"),this.callback=t.callback,t.$watch("done",function(e){this.done=e}.bind(this))}],link:function(e,n,r){t(r)}}}])}),define("appraisals/directives/grades-chart",["common/d3","appraisals/modules/directives"],function(e,t){"use strict";t.directive("crmGradesChart",["$log",function(t){function r(e){var t={};return t.outer={height:e.clientHeight,width:e.clientWidth},t.inner={width:t.outer.width-n.left-n.right,height:t.outer.height-n.top-n.bottom},t}function i(e){return typeof e.chartData=="undefined"?(t.error("[chart-data] is mandatory"),!1):!0}function s(e){e.innerHTML=""}function o(t){return{x:e.svg.axis().scale(t.x).tickFormat(function(e,t){return t+1}).orient("bottom"),y:e.svg.axis().scale(t.y).orient("left").ticks(4)}}function u(t,n){return{x:e.scale.ordinal().domain(e.range(n.length)).rangeBands([0,t.inner.width],.3),y:e.scale.linear().domain([0,100]).range([t.inner.height,0])}}function a(t,i){var s=r(t),a=u(s,i),f=o(a),l=e.select(t).append("svg").attr("width",s.outer.width).attr("height",s.outer.height).append("g").attr("transform","translate("+n.left+", "+n.top+")");l.append("g").attr("class","chart-axis chart-axis-x").attr("transform","translate(0,"+s.inner.height+")").call(f.x),l.append("g").attr("class","chart-axis chart-axis-y").call(f.y),l.selectAll("rect").data(i).enter().append("rect").attr("x",function(e,t){return a.x(t)}).attr("y",function(e){return a.y(e.value)}).attr("width",a.x.rangeBand()).attr("height",function(e){return s.inner.height-a.y(e.value)}).attr("class",function(e,t){return"chart-color-"+t})}function f(e){var n=!0;return Array.isArray(e)?e.every(function(e){return e.label&&e.value})||(n=!1)||t.error("Elements in [chart-data] must have a `label` and a `value` property"):(n=!1)||t.error("[chart-data] must be an array of objects"),n}var n={top:30,bottom:30,left:50,right:30};return{scope:{chartData:"="},restrict:"A",link:function(e,n,r){t.debug("crmGradesChart"),i(r)&&(n=n[0],e.$watch("chartData",function(e){s(n),f(e)&&a(n,e)}),window.onresize=function(){s(n),a(n,e.chartData)})}}}])}),define("appraisals/models/appraisal",["appraisals/modules/models","common/models/model","common/mocks/services/api/appraisal-mock"],function(e){"use strict";e.factory("Appraisal",["$log","Model","api.appraisal.mock","AppraisalInstance",function(e,t,n,r){return t.extend({all:function(e,t){return n.all(this.processFilters(e),t).then(function(e){return e.list=e.list.map(function(e){return r.init(e,!0)}),e})},create:function(t){t.contact_id||e.error("ERR_APPRAISAL_CREATE: CONTACT ID MISSING"),t.appraisal_cycle_id||e.error("ERR_APPRAISAL_CREATE: APPRAISAL CYCLE ID MISSING");var i=r.init(t).toAPI();return n.create(i).then(function(e){return r.init(e,!0)})},find:function(e){return n.find(e).then(function(e){return r.init(e,!0)})},overdue:function(e){return n.overdue(e).then(function(e){return e.list=e.list.map(function(e){return r.init(e,!0)}),e})}})}])}),define("appraisals/models/instances/appraisal-instance",["common/lodash","common/moment","appraisals/modules/models-instances","common/models/instances/instance"],function(e,t,n){"use strict";n.factory("AppraisalInstance",["ModelInstance","HR_settings",function(n,r){var i=["meeting_completed","approved_by_employee","is_current"];return n.extend({fromAPIFilter:function(n,s,o){var u=r.DATE_FORMAT.toUpperCase();e.endsWith(o,"_date")||e.endsWith(o,"_due")?n[o]=t(this[o],"YYYY-MM-DD").format(u):e.includes(i,o)?n[o]=!!+this[o]:n[o]=this[o]},toAPIFilter:function(n,s,o){var u=r.DATE_FORMAT.toUpperCase();e.endsWith(o,"_date")||e.endsWith(o,"_due")?n[o]=t(this[o],u).format("YYYY-MM-DD"):e.includes(i,o)?n[o]=""+ +this[o]:n[o]=this[o]}})}])}),define("appraisals/models/instances/appraisal-cycle-instance",["common/lodash","common/moment","appraisals/modules/models-instances","common/services/api/appraisal-cycle","common/models/instances/instance","appraisals/models/appraisal"],function(e,t,n){"use strict";n.factory("AppraisalCycleInstance",["$q","Appraisal","ModelInstance","api.appraisal-cycle","HR_settings",function(n,r,i,s,o){function f(t){this.statuses=e.reduce(t,function(e,t){return e[t.status_id]={name:t.status_name,appraisals_count:t.appraisals_count},t.appraisals&&(e[t.status_id].appraisals=t.appraisals),this.appraisals_count+=+t.appraisals_count,e},{},this),this.appraisals_count>0&&(this.completion_percentage=Math.round(this.statuses[5].appraisals_count*100/this.appraisals_count))}var u={cycle_self_appraisal_due:"1",cycle_manager_appraisal_due:"2",cycle_grade_due:"3"},a=e.memoize(function(r,i){var s,a,f,l=o.DATE_FORMAT.toUpperCase();return s=t(),a=e.chain(i).transform(function(e,n,r){e[r]=t(n,l)}).pick(function(e){return e.isSameOrAfter(s,"day")}).value(),e.isEmpty(a)?null:(f=t.min.apply(t,e.values(a)),{date:f.format(l),status_id:u[e.findKey(a,function(e){return e===e})]})});return i.extend({defaultCustomData:function(){return{appraisals:[],appraisals_count:0,completion_percentage:0,statuses:{}}},dueDates:function(){return e.pick(this.attributes(),function(t,n){return e.endsWith(n,"_due")})},fromAPIFilter:function(n,r,i){var s=o.DATE_FORMAT.toUpperCase();e.endsWith(i,"_date")||e.endsWith(i,"_due")?n[i]=t(this[i],"YYYY-MM-DD").format(s):i==="api.AppraisalCycle.getappraisalsperstep"?f.call(n,this[i].values):i==="cycle_is_active"?n[i]=!!+this[i]:n[i]=this[i]},isStatusOverdue:function(n){var r=o.DATE_FORMAT.toUpperCase(),i=e.invert(u)[n];return t(this[i],r).isBefore(t())},loadAppraisals:function(e){var t="all";return typeof e!="undefined"&&e.overdue===!0&&(t="overdue"),r[t]({appraisal_cycle_id:this.id}).then(function(e){this.appraisals=e.list}.bind(this))},nextDueDate:function(){var t=this.dueDates(),n=(this.id||this.name)+e.values(t).join("");return a(n,t)},toAPIFilter:function(n,r,i){var s=o.DATE_FORMAT.toUpperCase(),u=["appraisals","appraisals_count","completion_percentage"];if(e.endsWith(i,"_date")||e.endsWith(i,"_due"))n[i]=t(this[i],s).format("YYYY-MM-DD");else{if(e.includes(u,i))return;n[i]=this[i]}},update:function(t){var r=n.defer();return this.id?r.resolve(s.update(this.toAPI()).then(function(t){e.assign(this,this.fromAPI(t))}.bind(this))):r.reject("ERR_UPDATE: ID_MISSING"),r.promise}})}])}),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ui.router"),function(e,t,n){"use strict";function r(e,t){return I(new(I(function(){},{prototype:e})),t)}function i(e){return F(arguments,function(t){t!==e&&F(t,function(t,n){e.hasOwnProperty(n)||(e[n]=t)})}),e}function s(e,t){var n=[];for(var r in e.path){if(e.path[r]!==t.path[r])break;n.push(e.path[r])}return n}function o(e){if(Object.keys)return Object.keys(e);var t=[];return F(e,function(e,n){t.push(n)}),t}function u(e,t){if(Array.prototype.indexOf)return e.indexOf(t,Number(arguments[2])||0);var n=e.length>>>0,r=Number(arguments[2])||0;for(r=0>r?Math.ceil(r):Math.floor(r),0>r&&(r+=n);n>r;r++)if(r in e&&e[r]===t)return r;return-1}function a(e,t,n,r){var i,a=s(n,r),f={},l=[];for(var c in a)if(a[c].params&&(i=o(a[c].params),i.length))for(var h in i)u(l,i[h])>=0||(l.push(i[h]),f[i[h]]=e[i[h]]);return I({},f,t)}function f(e,t,n){if(!n){n=[];for(var r in e)n.push(r)}for(var i=0;i<n.length;i++){var s=n[i];if(e[s]!=t[s])return!1}return!0}function l(e,t){var n={};return F(e,function(e){n[e]=t[e]}),n}function c(e){var t={},n=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));return F(n,function(n){n in e&&(t[n]=e[n])}),t}function h(e){var t={},n=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));for(var r in e)-1==u(n,r)&&(t[r]=e[r]);return t}function p(e,t){var n=j(e),r=n?[]:{};return F(e,function(e,i){t(e,i)&&(r[n?r.length:i]=e)}),r}function d(e,t){var n=j(e)?[]:{};return F(e,function(e,r){n[r]=t(e,r)}),n}function v(e,t){var r=1,s=2,a={},f=[],l=a,c=I(e.when(a),{$$promises:a,$$values:a});this.study=function(a){function p(e,n){if(y[n]!==s){if(g.push(n),y[n]===r)throw g.splice(0,u(g,n)),new Error("Cyclic dependency: "+g.join(" -> "));if(y[n]=r,H(e))m.push(n,[function(){return t.get(e)}],f);else{var i=t.annotate(e);F(i,function(e){e!==n&&a.hasOwnProperty(e)&&p(a[e],e)}),m.push(n,e,i)}g.pop(),y[n]=s}}function d(e){return B(e)&&e.then&&e.$$promises}if(!B(a))throw new Error("'invocables' must be an object");var v=o(a||{}),m=[],g=[],y={};return F(a,p),a=g=y=null,function(r,s,o){function u(){--w||(E||i(b,s.$$values),g.$$values=b,g.$$promises=g.$$promises||!0,delete g.$$inheritedValues,p.resolve(b))}function a(e){g.$$failure=e,p.reject(e)}function f(n,i,s){function f(e){c.reject(e),a(e)}function l(){if(!D(g.$$failure))try{c.resolve(t.invoke(i,o,b)),c.promise.then(function(e){b[n]=e,u()},f)}catch(e){f(e)}}var c=e.defer(),h=0;F(s,function(e){y.hasOwnProperty(e)&&!r.hasOwnProperty(e)&&(h++,y[e].then(function(t){b[e]=t,--h||l()},f))}),h||l(),y[n]=c.promise}if(d(r)&&o===n&&(o=s,s=r,r=null),r){if(!B(r))throw new Error("'locals' must be an object")}else r=l;if(s){if(!d(s))throw new Error("'parent' must be a promise returned by $resolve.resolve()")}else s=c;var p=e.defer(),g=p.promise,y=g.$$promises={},b=I({},r),w=1+m.length/3,E=!1;if(D(s.$$failure))return a(s.$$failure),g;s.$$inheritedValues&&i(b,h(s.$$inheritedValues,v)),I(y,s.$$promises),s.$$values?(E=i(b,h(s.$$values,v)),g.$$inheritedValues=h(s.$$values,v),u()):(s.$$inheritedValues&&(g.$$inheritedValues=h(s.$$inheritedValues,v)),s.then(u,a));for(var S=0,x=m.length;x>S;S+=3)r.hasOwnProperty(m[S])?u():f(m[S],m[S+1],m[S+2]);return g}},this.resolve=function(e,t,n,r){return this.study(e)(t,n,r)}}function m(e,t,n){this.fromConfig=function(e,t,n){return D(e.template)?this.fromString(e.template,t):D(e.templateUrl)?this.fromUrl(e.templateUrl,t):D(e.templateProvider)?this.fromProvider(e.templateProvider,t,n):null},this.fromString=function(e,t){return P(e)?e(t):e},this.fromUrl=function(n,r){return P(n)&&(n=n(r)),null==n?null:e.get(n,{cache:t,headers:{Accept:"text/html"}}).then(function(e){return e.data})},this.fromProvider=function(e,t,r){return n.invoke(e,null,r||{params:t})}}function g(e,t,i){function s(t,n,r,i){if(m.push(t),d[t])return d[t];if(!/^\w+(-+\w+)*(?:\[\])?$/.test(t))throw new Error("Invalid parameter name '"+t+"' in pattern '"+e+"'");if(v[t])throw new Error("Duplicate parameter name '"+t+"' in pattern '"+e+"'");return v[t]=new R.Param(t,n,r,i),v[t]}function o(e,t,n,r){var i=["",""],s=e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!t)return s;switch(n){case!1:i=["(",")"+(r?"?":"")];break;case!0:i=["?(",")?"];break;default:i=["("+n+"|",")?"]}return s+i[0]+t+i[1]}function u(i,s){var o,u,a,f,l;return o=i[2]||i[3],l=t.params[o],a=e.substring(h,i.index),u=s?i[4]:i[4]||("*"==i[1]?".*":null),f=R.type(u||"string")||r(R.type("string"),{pattern:new RegExp(u,t.caseInsensitive?"i":n)}),{id:o,regexp:u,segment:a,type:f,cfg:l}}t=I({params:{}},B(t)?t:{});var a,f=/([:*])([\w\[\]]+)|\{([\w\[\]]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,l=/([:]?)([\w\[\]-]+)|\{([\w\[\]-]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,c="^",h=0,p=this.segments=[],d=i?i.params:{},v=this.params=i?i.params.$$new():new R.ParamSet,m=[];this.source=e;for(var g,y,b;(a=f.exec(e))&&(g=u(a,!1),!(g.segment.indexOf("?")>=0));)y=s(g.id,g.type,g.cfg,"path"),c+=o(g.segment,y.type.pattern.source,y.squash,y.isOptional),p.push(g.segment),h=f.lastIndex;b=e.substring(h);var w=b.indexOf("?");if(w>=0){var E=this.sourceSearch=b.substring(w);if(b=b.substring(0,w),this.sourcePath=e.substring(0,h+w),E.length>0)for(h=0;a=l.exec(E);)g=u(a,!0),y=s(g.id,g.type,g.cfg,"search"),h=f.lastIndex}else this.sourcePath=e,this.sourceSearch="";c+=o(b)+(t.strict===!1?"/?":"")+"$",p.push(b),this.regexp=new RegExp(c,t.caseInsensitive?"i":n),this.prefix=p[0],this.$$paramNames=m}function y(e){I(this,e)}function b(){function e(e){return null!=e?e.toString().replace(/\//g,"%2F"):e}function i(e){return null!=e?e.toString().replace(/%2F/g,"/"):e}function s(){return{strict:v,caseInsensitive:h}}function a(e){return P(e)||j(e)&&P(e[e.length-1])}function f(){for(;S.length;){var e=S.shift();if(e.pattern)throw new Error("You cannot override a type's .pattern at runtime.");t.extend(w[e.name],c.invoke(e.def))}}function l(e){I(this,e||{})}R=this;var c,h=!1,v=!0,m=!1,w={},E=!0,S=[],x={string:{encode:e,decode:i,is:function(e){return null==e||!D(e)||"string"==typeof e},pattern:/[^/]*/},"int":{encode:e,decode:function(e){return parseInt(e,10)},is:function(e){return D(e)&&this.decode(e.toString())===e},pattern:/\d+/},bool:{encode:function(e){return e?1:0},decode:function(e){return 0!==parseInt(e,10)},is:function(e){return e===!0||e===!1},pattern:/0|1/},date:{encode:function(e){return this.is(e)?[e.getFullYear(),("0"+(e.getMonth()+1)).slice(-2),("0"+e.getDate()).slice(-2)].join("-"):n},decode:function(e){if(this.is(e))return e;var t=this.capture.exec(e);return t?new Date(t[1],t[2]-1,t[3]):n},is:function(e){return e instanceof Date&&!isNaN(e.valueOf())},equals:function(e,t){return this.is(e)&&this.is(t)&&e.toISOString()===t.toISOString()},pattern:/[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])/,capture:/([0-9]{4})-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/},json:{encode:t.toJson,decode:t.fromJson,is:t.isObject,equals:t.equals,pattern:/[^/]*/},any:{encode:t.identity,decode:t.identity,equals:t.equals,pattern:/.*/}};b.$$getDefaultValue=function(e){if(!a(e.value))return e.value;if(!c)throw new Error("Injectable functions cannot be called at configuration time");return c.invoke(e.value)},this.caseInsensitive=function(e){return D(e)&&(h=e),h},this.strictMode=function(e){return D(e)&&(v=e),v},this.defaultSquashPolicy=function(e){if(!D(e))return m;if(e!==!0&&e!==!1&&!H(e))throw new Error("Invalid squash policy: "+e+". Valid policies: false, true, arbitrary-string");return m=e,e},this.compile=function(e,t){return new g(e,I(s(),t))},this.isMatcher=function(e){if(!B(e))return!1;var t=!0;return F(g.prototype,function(n,r){P(n)&&(t=t&&D(e[r])&&P(e[r]))}),t},this.type=function(e,t,n){if(!D(t))return w[e];if(w.hasOwnProperty(e))throw new Error("A type named '"+e+"' has already been defined.");return w[e]=new y(I({name:e},t)),n&&(S.push({name:e,def:n}),E||f()),this},F(x,function(e,t){w[t]=new y(I({name:t},e))}),w=r(w,{}),this.$get=["$injector",function(e){return c=e,E=!1,f(),F(x,function(e,t){w[t]||(w[t]=new y(e))}),this}],this.Param=function(e,t,r,i){function s(e){var t=B(e)?o(e):[],n=-1===u(t,"value")&&-1===u(t,"type")&&-1===u(t,"squash")&&-1===u(t,"array");return n&&(e={value:e}),e.$$fn=a(e.value)?e.value:function(){return e.value},e}function f(t,n,r){if(t.type&&n)throw new Error("Param '"+e+"' has two type configurations.");return n?n:t.type?t.type instanceof y?t.type:new y(t.type):"config"===r?w.any:w.string}function l(){var t={array:"search"===i?"auto":!1},n=e.match(/\[\]$/)?{array:!0}:{};return I(t,n,r).array}function h(e,t){var n=e.squash;if(!t||n===!1)return!1;if(!D(n)||null==n)return m;if(n===!0||H(n))return n;throw new Error("Invalid squash policy: '"+n+"'. Valid policies: false, true, or arbitrary string")}function v(e,t,r,i){var s,o,a=[{from:"",to:r||t?n:""},{from:null,to:r||t?n:""}];return s=j(e.replace)?e.replace:[],H(i)&&s.push({from:i,to:n}),o=d(s,function(e){return e.from}),p(a,function(e){return-1===u(o,e.from)}).concat(s)}function g(){if(!c)throw new Error("Injectable functions cannot be called at configuration time");var e=c.invoke(r.$$fn);if(null!==e&&e!==n&&!S.type.is(e))throw new Error("Default value ("+e+") for parameter '"+S.id+"' is not an instance of Type ("+S.type.name+")");return e}function b(e){function t(e){return function(t){return t.from===e}}function n(e){var n=d(p(S.replace,t(e)),function(e){return e.to});return n.length?n[0]:e}return e=n(e),D(e)?S.type.$normalize(e):g()}function E(){return"{Param:"+e+" "+t+" squash: '"+N+"' optional: "+T+"}"}var S=this;r=s(r),t=f(r,t,i);var x=l();t=x?t.$asArray(x,"search"===i):t,"string"!==t.name||x||"path"!==i||r.value!==n||(r.value="");var T=r.value!==n,N=h(r,T),C=v(r,x,T,N);I(this,{id:e,type:t,location:i,array:x,squash:N,replace:C,isOptional:T,value:b,dynamic:n,config:r,toString:E})},l.prototype={$$new:function(){return r(this,I(new l,{$$parent:this}))},$$keys:function(){for(var e=[],t=[],n=this,r=o(l.prototype);n;)t.push(n),n=n.$$parent;return t.reverse(),F(t,function(t){F(o(t),function(t){-1===u(e,t)&&-1===u(r,t)&&e.push(t)})}),e},$$values:function(e){var t={},n=this;return F(n.$$keys(),function(r){t[r]=n[r].value(e&&e[r])}),t},$$equals:function(e,t){var n=!0,r=this;return F(r.$$keys(),function(i){var s=e&&e[i],o=t&&t[i];r[i].type.equals(s,o)||(n=!1)}),n},$$validates:function(e){var r,i,s,o,u,a=this.$$keys();for(r=0;r<a.length&&(i=this[a[r]],s=e[a[r]],s!==n&&null!==s||!i.isOptional);r++){if(o=i.type.$normalize(s),!i.type.is(o))return!1;if(u=i.type.encode(o),t.isString(u)&&!i.type.pattern.exec(u))return!1}return!0},$$parent:n},this.ParamSet=l}function w(e,r){function i(e){var t=/^\^((?:\\[^a-zA-Z0-9]|[^\\\[\]\^$*+?.()|{}]+)*)/.exec(e.source);return null!=t?t[1].replace(/\\(.)/g,"$1"):""}function s(e,t){return e.replace(/\$(\$|\d{1,2})/,function(e,n){return t["$"===n?0:Number(n)]})}function o(e,t,n){if(!n)return!1;var r=e.invoke(t,t,{$match:n});return D(r)?r:!0}function u(r,i,s,o){function u(e,t,n){return"/"===v?e:t?v.slice(0,-1)+e:n?v.slice(1)+e:e}function h(e){function t(e){var t=e(s,r);return t?(H(t)&&r.replace().url(t),!0):!1}if(!e||!e.defaultPrevented){d&&r.url()===d,d=n;var i,o=f.length;for(i=0;o>i;i++)if(t(f[i]))return;l&&t(l)}}function p(){return a=a||i.$on("$locationChangeSuccess",h)}var d,v=o.baseHref(),m=r.url();return c||p(),{sync:function(){h()},listen:function(){return p()},update:function(e){return e?void (m=r.url()):void (r.url()!==m&&(r.url(m),r.replace()))},push:function(e,t,i){var s=e.format(t||{});null!==s&&t&&t["#"]&&(s+="#"+t["#"]),r.url(s),d=i&&i.$$avoidResync?r.url():n,i&&i.replace&&r.replace()},href:function(n,i,s){if(!n.validates(i))return null;var o=e.html5Mode();t.isObject(o)&&(o=o.enabled);var a=n.format(i);if(s=s||{},o||null===a||(a="#"+e.hashPrefix()+a),null!==a&&i&&i["#"]&&(a+="#"+i["#"]),a=u(a,o,s.absolute),!s.absolute||!a)return a;var f=!o&&a?"/":"",l=r.port();return l=80===l||443===l?"":":"+l,[r.protocol(),"://",r.host(),l,f,a].join("")}}}var a,f=[],l=null,c=!1;this.rule=function(e){if(!P(e))throw new Error("'rule' must be a function");return f.push(e),this},this.otherwise=function(e){if(H(e)){var t=e;e=function(){return t}}else if(!P(e))throw new Error("'rule' must be a function");return l=e,this},this.when=function(e,t){var n,u=H(t);if(H(e)&&(e=r.compile(e)),!u&&!P(t)&&!j(t))throw new Error("invalid 'handler' in when()");var a={matcher:function(e,t){return u&&(n=r.compile(t),t=["$match",function(e){return n.format(e)}]),I(function(n,r){return o(n,t,e.exec(r.path(),r.search()))},{prefix:H(e.prefix)?e.prefix:""})},regex:function(e,t){if(e.global||e.sticky)throw new Error("when() RegExp must not be global or sticky");return u&&(n=t,t=["$match",function(e){return s(n,e)}]),I(function(n,r){return o(n,t,e.exec(r.path()))},{prefix:i(e)})}},f={matcher:r.isMatcher(e),regex:e instanceof RegExp};for(var l in f)if(f[l])return this.rule(a[l](e,t));throw new Error("invalid 'what' in when()")},this.deferIntercept=function(e){e===n&&(e=!0),c=e},this.$get=u,u.$inject=["$location","$rootScope","$injector","$browser"]}function E(e,i){function s(e){return 0===e.indexOf(".")||0===e.indexOf("^")}function h(e,t){if(!e)return n;var r=H(e),i=r?e:e.name,o=s(i);if(o){if(!t)throw new Error("No reference point given for path '"+i+"'");t=h(t);for(var u=i.split("."),a=0,f=u.length,l=t;f>a;a++)if(""!==u[a]||0!==a){if("^"!==u[a])break;if(!l.parent)throw new Error("Path '"+i+"' not valid for state '"+t.name+"'");l=l.parent}else l=t;u=u.slice(a).join("."),i=l.name+(l.name&&u?".":"")+u}var c=N[i];return!c||!r&&(r||c!==e&&c.self!==e)?n:c}function p(e,t){C[e]||(C[e]=[]),C[e].push(t)}function v(e){for(var t=C[e]||[];t.length;)m(t.shift())}function m(t){t=r(t,{self:t,resolve:t.resolve||{},toString:function(){return this.name}});var n=t.name;if(!H(n)||n.indexOf("@")>=0)throw new Error("State must have a valid name");if(N.hasOwnProperty(n))throw new Error("State '"+n+"'' is already defined");var i=-1!==n.indexOf(".")?n.substring(0,n.lastIndexOf(".")):H(t.parent)?t.parent:B(t.parent)&&H(t.parent.name)?t.parent.name:"";if(i&&!N[i])return p(i,t.self);for(var s in L)P(L[s])&&(t[s]=L[s](t,L.$delegates[s]));return N[n]=t,!t[k]&&t.url&&e.when(t.url,["$match","$stateParams",function(e,n){T.$current.navigable==t&&f(e,n)||T.transitionTo(t,e,{inherit:!0,location:!1})}]),v(n),t}function g(e){return e.indexOf("*")>-1}function y(e){for(var t=e.split("."),n=T.$current.name.split("."),r=0,i=t.length;i>r;r++)"*"===t[r]&&(n[r]="*");return"**"===t[0]&&(n=n.slice(u(n,t[1])),n.unshift("**")),"**"===t[t.length-1]&&(n.splice(u(n,t[t.length-2])+1,Number.MAX_VALUE),n.push("**")),t.length!=n.length?!1:n.join("")===t.join("")}function b(e,t){return H(e)&&!D(t)?L[e]:P(t)&&H(e)?(L[e]&&!L.$delegates[e]&&(L.$delegates[e]=L[e]),L[e]=t,this):this}function w(e,t){return B(e)?t=e:t.name=e,m(t),this}function E(e,i,s,u,c,p,v,m,b){function w(t,n,r,s){var o=e.$broadcast("$stateNotFound",t,n,r);if(o.defaultPrevented)return v.update(),A;if(!o.retry)return null;if(s.$retry)return v.update(),O;var u=T.transition=i.when(o.retry);return u.then(function(){return u!==T.transition?C:(t.options.$retry=!0,T.transitionTo(t.to,t.toParams,t.options))},function(){return A}),v.update(),u}function E(e,n,r,o,a,f){function h(){var n=[];return F(e.views,function(r,i){var o=r.resolve&&r.resolve!==e.resolve?r.resolve:{};o.$template=[function(){return s.load(i,{view:r,locals:a.globals,params:p,notify:f.notify})||""}],n.push(c.resolve(o,a.globals,a.resolve,e).then(function(n){if(P(r.controllerProvider)||j(r.controllerProvider)){var s=t.extend({},o,a.globals);n.$$controller=u.invoke(r.controllerProvider,null,s)}else n.$$controller=r.controller;n.$$state=e,n.$$controllerAs=r.controllerAs,a[i]=n}))}),i.all(n).then(function(){return a.globals})}var p=r?n:l(e.params.$$keys(),n),d={$stateParams:p};a.resolve=c.resolve(e.resolve,d,a.resolve,e);var v=[a.resolve.then(function(e){a.globals=e})];return o&&v.push(o),i.all(v).then(h).then(function(e){return a})}var C=i.reject(new Error("transition superseded")),L=i.reject(new Error("transition prevented")),A=i.reject(new Error("transition aborted")),O=i.reject(new Error("transition failed"));return x.locals={resolve:null,globals:{$stateParams:{}}},T={params:{},current:x.self,$current:x,transition:null},T.reload=function(e){return T.transitionTo(T.current,p,{reload:e||!0,inherit:!1,notify:!0})},T.go=function(e,t,n){return T.transitionTo(e,t,I({inherit:!0,relative:T.$current},n))},T.transitionTo=function(t,n,s){n=n||{},s=I({location:!0,inherit:!1,relative:null,notify:!0,reload:!1,$retry:!1},s||{});var o,f=T.$current,c=T.params,d=f.path,m=h(t,s.relative),g=n["#"];if(!D(m)){var y={to:t,toParams:n,options:s},b=w(y,f.self,c,s);if(b)return b;if(t=y.to,n=y.toParams,s=y.options,m=h(t,s.relative),!D(m))throw s.relative?new Error("Could not resolve '"+t+"' from state '"+s.relative+"'"):new Error("No such state '"+t+"'")}if(m[k])throw new Error("Cannot transition to abstract state '"+t+"'");if(s.inherit&&(n=a(p,n||{},T.$current,m)),!m.params.$$validates(n))return O;n=m.params.$$values(n),t=m;var N=t.path,A=0,M=N[A],_=x.locals,P=[];if(s.reload){if(H(s.reload)||B(s.reload)){if(B(s.reload)&&!s.reload.name)throw new Error("Invalid reload state object");var j=s.reload===!0?d[0]:h(s.reload);if(s.reload&&!j)throw new Error("No such reload state '"+(H(s.reload)?s.reload:s.reload.name)+"'");for(;M&&M===d[A]&&M!==j;)_=P[A]=M.locals,A++,M=N[A]}}else for(;M&&M===d[A]&&M.ownParams.$$equals(n,c);)_=P[A]=M.locals,A++,M=N[A];if(S(t,n,f,c,_,s))return g&&(n["#"]=g),T.params=n,q(T.params,p),s.location&&t.navigable&&t.navigable.url&&(v.push(t.navigable.url,n,{$$avoidResync:!0,replace:"replace"===s.location}),v.update(!0)),T.transition=null,i.when(T.current);if(n=l(t.params.$$keys(),n||{}),s.notify&&e.$broadcast("$stateChangeStart",t.self,n,f.self,c).defaultPrevented)return e.$broadcast("$stateChangeCancel",t.self,n,f.self,c),v.update(),L;for(var F=i.when(_),R=A;R<N.length;R++,M=N[R])_=P[R]=r(_),F=E(M,n,M===t,F,_,s);var U=T.transition=F.then(function(){var r,i,o;if(T.transition!==U)return C;for(r=d.length-1;r>=A;r--)o=d[r],o.self.onExit&&u.invoke(o.self.onExit,o.self,o.locals.globals),o.locals=null;for(r=A;r<N.length;r++)i=N[r],i.locals=P[r],i.self.onEnter&&u.invoke(i.self.onEnter,i.self,i.locals.globals);return g&&(n["#"]=g),T.transition!==U?C:(T.$current=t,T.current=t.self,T.params=n,q(T.params,p),T.transition=null,s.location&&t.navigable&&v.push(t.navigable.url,t.navigable.locals.globals.$stateParams,{$$avoidResync:!0,replace:"replace"===s.location}),s.notify&&e.$broadcast("$stateChangeSuccess",t.self,n,f.self,c),v.update(!0),T.current)},function(r){return T.transition!==U?C:(T.transition=null,o=e.$broadcast("$stateChangeError",t.self,n,f.self,c,r),o.defaultPrevented||v.update(),i.reject(r))});return U},T.is=function(e,t,r){r=I({relative:T.$current},r||{});var i=h(e,r.relative);return D(i)?T.$current!==i?!1:t?f(i.params.$$values(t),p):!0:n},T.includes=function(e,t,r){if(r=I({relative:T.$current},r||{}),H(e)&&g(e)){if(!y(e))return!1;e=T.$current.name}var i=h(e,r.relative);return D(i)?D(T.$current.includes[i.name])?t?f(i.params.$$values(t),p,o(t)):!0:!1:n},T.href=function(e,t,r){r=I({lossy:!0,inherit:!0,absolute:!1,relative:T.$current},r||{});var i=h(e,r.relative);if(!D(i))return null;r.inherit&&(t=a(p,t||{},T.$current,i));var s=i&&r.lossy?i.navigable:i;return s&&s.url!==n&&null!==s.url?v.href(s.url,l(i.params.$$keys().concat("#"),t||{}),{absolute:r.absolute}):null},T.get=function(e,t){if(0===arguments.length)return d(o(N),function(e){return N[e].self});var n=h(e,t||T.$current);return n&&n.self?n.self:null},T}function S(e,t,n,r,i,s){function o(e,t,n){function r(t){return"search"!=e.params[t].location}var i=e.params.$$keys().filter(r),s=c.apply({},[e.params].concat(i)),o=new R.ParamSet(s);return o.$$equals(t,n)}return!s.reload&&e===n&&(i===n.locals||e.self.reloadOnSearch===!1&&o(n,r,t))?!0:void 0}var x,T,N={},C={},k="abstract",L={parent:function(e){if(D(e.parent)&&e.parent)return h(e.parent);var t=/^(.+)\.[^.]+$/.exec(e.name);return t?h(t[1]):x},data:function(e){return e.parent&&e.parent.data&&(e.data=e.self.data=I({},e.parent.data,e.data)),e.data},url:function(e){var t=e.url,n={params:e.params||{}};if(H(t))return"^"==t.charAt(0)?i.compile(t.substring(1),n):(e.parent.navigable||x).url.concat(t,n);if(!t||i.isMatcher(t))return t;throw new Error("Invalid url '"+t+"' in state '"+e+"'")},navigable:function(e){return e.url?e:e.parent?e.parent.navigable:null},ownParams:function(e){var t=e.url&&e.url.params||new R.ParamSet;return F(e.params||{},function(e,n){t[n]||(t[n]=new R.Param(n,null,e,"config"))}),t},params:function(e){return e.parent&&e.parent.params?I(e.parent.params.$$new(),e.ownParams):new R.ParamSet},views:function(e){var t={};return F(D(e.views)?e.views:{"":e},function(n,r){r.indexOf("@")<0&&(r+="@"+e.parent.name),t[r]=n}),t},path:function(e){return e.parent?e.parent.path.concat(e):[]},includes:function(e){var t=e.parent?I({},e.parent.includes):{};return t[e.name]=!0,t},$delegates:{}};x=m({name:"",url:"^",views:null,"abstract":!0}),x.navigable=null,this.decorator=b,this.state=w,this.$get=E,E.$inject=["$rootScope","$q","$view","$injector","$resolve","$stateParams","$urlRouter","$location","$urlMatcherFactory"]}function S(){function e(e,t){return{load:function(n,r){var i,s={template:null,controller:null,view:null,locals:null,notify:!0,async:!0,params:{}};return r=I(s,r),r.view&&(i=t.fromConfig(r.view,r.params,r.locals)),i&&r.notify&&e.$broadcast("$viewContentLoading",r),i}}}this.$get=e,e.$inject=["$rootScope","$templateFactory"]}function x(){var e=!1;this.useAnchorScroll=function(){e=!0},this.$get=["$anchorScroll","$timeout",function(t,n){return e?t:function(e){return n(function(){e[0].scrollIntoView()},0,!1)}}]}function T(e,n,r,i){function s(){return n.has?function(e){return n.has(e)?n.get(e):null}:function(e){try{return n.get(e)}catch(t){return null}}}function o(e,t){var n=function(){return{enter:function(e,t,n){t.after(e),n()},leave:function(e,t){e.remove(),t()}}};if(f)return{enter:function(e,t,n){var r=f.enter(e,null,t,n);r&&r.then&&r.then(n)},leave:function(e,t){var n=f.leave(e,t);n&&n.then&&n.then(t)}};if(a){var r=a&&a(t,e);return{enter:function(e,t,n){r.enter(e,null,t),n()},leave:function(e,t){r.leave(e),t()}}}return n()}var u=s(),a=u("$animator"),f=u("$animate"),l={restrict:"ECA",terminal:!0,priority:400,transclude:"element",compile:function(n,s,u){return function(n,s,a){function f(){c&&(c.remove(),c=null),p&&(p.$destroy(),p=null),h&&(g.leave(h,function(){c=null}),c=h,h=null)}function l(o){var l,c=C(n,a,s,i),y=c&&e.$current&&e.$current.locals[c];if(o||y!==d){l=n.$new(),d=e.$current.locals[c];var b=u(l,function(e){g.enter(e,s,function(){p&&p.$emit("$viewContentAnimationEnded"),(t.isDefined(m)&&!m||n.$eval(m))&&r(e)}),f()});h=b,p=l,p.$emit("$viewContentLoaded"),p.$eval(v)}}var c,h,p,d,v=a.onload||"",m=a.autoscroll,g=o(a,n);n.$on("$stateChangeSuccess",function(){l(!1)}),n.$on("$viewContentLoading",function(){l(!1)}),l(!0)}}};return l}function N(e,t,n,r){return{restrict:"ECA",priority:-400,compile:function(i){var s=i.html();return function(i,o,u){var a=n.$current,f=C(i,u,o,r),l=a&&a.locals[f];if(l){o.data("$uiView",{name:f,state:l.$$state}),o.html(l.$template?l.$template:s);var c=e(o.contents());if(l.$$controller){l.$scope=i,l.$element=o;var h=t(l.$$controller,l);l.$$controllerAs&&(i[l.$$controllerAs]=h),o.data("$ngControllerController",h),o.children().data("$ngControllerController",h)}c(i)}}}}}function C(e,t,n,r){var i=r(t.uiView||t.name||"")(e),s=n.inheritedData("$uiView");return i.indexOf("@")>=0?i:i+"@"+(s?s.state.name:"")}function k(e,t){var n,r=e.match(/^\s*({[^}]*})\s*$/);if(r&&(e=t+"("+r[1]+")"),n=e.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/),!n||4!==n.length)throw new Error("Invalid state ref '"+e+"'");return{state:n[1],paramExpr:n[3]||null}}function L(e){var t=e.parent().inheritedData("$uiView");return t&&t.state&&t.state.name?t.state:void 0}function A(e,n){var r=["location","inherit","reload","absolute"];return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(i,s,o,u){var a=k(o.uiSref,e.current.name),f=null,l=L(s)||e.$current,c="[object SVGAnimatedString]"===Object.prototype.toString.call(s.prop("href"))?"xlink:href":"href",h=null,p="A"===s.prop("tagName").toUpperCase(),d="FORM"===s[0].nodeName,v=d?"action":c,m=!0,g={relative:l,inherit:!0},y=i.$eval(o.uiSrefOpts)||{};t.forEach(r,function(e){e in y&&(g[e]=y[e])});var b=function(n){if(n&&(f=t.copy(n)),m){h=e.href(a.state,f,g);var r=u[1]||u[0];return r&&r.$$addStateInfo(a.state,f),null===h?(m=!1,!1):void o.$set(v,h)}};a.paramExpr&&(i.$watch(a.paramExpr,function(e,t){e!==f&&b(e)},!0),f=t.copy(i.$eval(a.paramExpr))),b(),d||s.bind("click",function(t){var r=t.which||t.button;if(!(r>1||t.ctrlKey||t.metaKey||t.shiftKey||s.attr("target"))){var i=n(function(){e.go(a.state,f,g)});t.preventDefault();var o=p&&!h?1:0;t.preventDefault=function(){o--<=0&&n.cancel(i)}}})}}}function O(e,t,n){return{restrict:"A",controller:["$scope","$element","$attrs",function(t,r,i){function s(){o()?r.addClass(a):r.removeClass(a)}function o(){for(var e=0;e<f.length;e++)if(u(f[e].state,f[e].params))return!0;return!1}function u(t,n){return"undefined"!=typeof i.uiSrefActiveEq?e.is(t.name,n):e.includes(t.name,n)}var a,f=[];a=n(i.uiSrefActiveEq||i.uiSrefActive||"",!1)(t),this.$$addStateInfo=function(t,n){var i=e.get(t,L(r));f.push({state:i||{name:t},params:n}),s()},t.$on("$stateChangeSuccess",s)}]}}function M(e){var t=function(t){return e.is(t)};return t.$stateful=!0,t}function _(e){var t=function(t){return e.includes(t)};return t.$stateful=!0,t}var D=t.isDefined,P=t.isFunction,H=t.isString,B=t.isObject,j=t.isArray,F=t.forEach,I=t.extend,q=t.copy;t.module("ui.router.util",["ng"]),t.module("ui.router.router",["ui.router.util"]),t.module("ui.router.state",["ui.router.router","ui.router.util"]),t.module("ui.router",["ui.router.state"]),t.module("ui.router.compat",["ui.router"]),v.$inject=["$q","$injector"],t.module("ui.router.util").service("$resolve",v),m.$inject=["$http","$templateCache","$injector"],t.module("ui.router.util").service("$templateFactory",m);var R;g.prototype.concat=function(e,t){var n={caseInsensitive:R.caseInsensitive(),strict:R.strictMode(),squash:R.defaultSquashPolicy()};return new g(this.sourcePath+e+this.sourceSearch,I(n,t),this)},g.prototype.toString=function(){return this.source},g.prototype.exec=function(e,t){function n(e){function t(e){return e.split("").reverse().join("")}function n(e){return e.replace(/\\-/g,"-")}var r=t(e).split(/-(?!\\)/),i=d(r,t);return d(i,n).reverse()}var r=this.regexp.exec(e);if(!r)return null;t=t||{};var i,s,o,u=this.parameters(),a=u.length,f=this.segments.length-1,l={};if(f!==r.length-1)throw new Error("Unbalanced capture group in route '"+this.source+"'");for(i=0;f>i;i++){o=u[i];var c=this.params[o],h=r[i+1];for(s=0;s<c.replace;s++)c.replace[s].from===h&&(h=c.replace[s].to);h&&c.array===!0&&(h=n(h)),l[o]=c.value(h)}for(;a>i;i++)o=u[i],l[o]=this.params[o].value(t[o]);return l},g.prototype.parameters=function(e){return D(e)?this.params[e]||null:this.$$paramNames},g.prototype.validates=function(e){return this.params.$$validates(e)},g.prototype.format=function(e){function t(e){return encodeURIComponent(e).replace(/-/g,function(e){return"%5C%"+e.charCodeAt(0).toString(16).toUpperCase()})}e=e||{};var n=this.segments,r=this.parameters(),i=this.params;if(!this.validates(e))return null;var s,o=!1,u=n.length-1,a=r.length,f=n[0];for(s=0;a>s;s++){var l=u>s,c=r[s],h=i[c],p=h.value(e[c]),v=h.isOptional&&h.type.equals(h.value(),p),m=v?h.squash:!1,g=h.type.encode(p);if(l){var y=n[s+1];if(m===!1)null!=g&&(f+=j(g)?d(g,t).join("-"):encodeURIComponent(g)),f+=y;else if(m===!0){var b=f.match(/\/$/)?/\/?(.*)/:/(.*)/;f+=y.match(b)[1]}else H(m)&&(f+=m+y)}else{if(null==g||v&&m!==!1)continue;j(g)||(g=[g]),g=d(g,encodeURIComponent).join("&"+c+"="),f+=(o?"&":"?")+(c+"="+g),o=!0}}return f},y.prototype.is=function(e,t){return!0},y.prototype.encode=function(e,t){return e},y.prototype.decode=function(e,t){return e},y.prototype.equals=function(e,t){return e==t},y.prototype.$subPattern=function(){var e=this.pattern.toString();return e.substr(1,e.length-2)},y.prototype.pattern=/.*/,y.prototype.toString=function(){return"{Type:"+this.name+"}"},y.prototype.$normalize=function(e){return this.is(e)?e:this.decode(e)},y.prototype.$asArray=function(e,t){function r(e,t){function r(e,t){return function(){return e[t].apply(e,arguments)}}function i(e){return j(e)?e:D(e)?[e]:[]}function s(e){switch(e.length){case 0:return n;case 1:return"auto"===t?e[0]:e;default:return e}}function o(e){return!e}function u(e,t){return function(n){n=i(n);var r=d(n,e);return t===!0?0===p(r,o).length:s(r)}}function a(e){return function(t,n){var r=i(t),s=i(n);if(r.length!==s.length)return!1;for(var o=0;o<r.length;o++)if(!e(r[o],s[o]))return!1;return!0}}this.encode=u(r(e,"encode")),this.decode=u(r(e,"decode")),this.is=u(r(e,"is"),!0),this.equals=a(r(e,"equals")),this.pattern=e.pattern,this.$normalize=u(r(e,"$normalize")),this.name=e.name,this.$arrayMode=t}if(!e)return this;if("auto"===e&&!t)throw new Error("'auto' array mode is for query parameters only");return new r(this,e)},t.module("ui.router.util").provider("$urlMatcherFactory",b),t.module("ui.router.util").run(["$urlMatcherFactory",function(e){}]),w.$inject=["$locationProvider","$urlMatcherFactoryProvider"],t.module("ui.router.router").provider("$urlRouter",w),E.$inject=["$urlRouterProvider","$urlMatcherFactoryProvider"],t.module("ui.router.state").value("$stateParams",{}).provider("$state",E),S.$inject=[],t.module("ui.router.state").provider("$view",S),t.module("ui.router.state").provider("$uiViewScroll",x),T.$inject=["$state","$injector","$uiViewScroll","$interpolate"],N.$inject=["$compile","$controller","$state","$interpolate"],t.module("ui.router.state").directive("uiView",T),t.module("ui.router.state").directive("uiView",N),A.$inject=["$state","$timeout"],O.$inject=["$state","$stateParams","$interpolate"],t.module("ui.router.state").directive("uiSref",A).directive("uiSrefActive",O).directive("uiSrefActiveEq",O),M.$inject=["$state"],_.$inject=["$state"],t.module("ui.router.state").filter("isState",M).filter("includedByState",_)}(window,window.angular),define("appraisals/app",["appraisals/utils/routes","common/angular","common/angularBootstrap","common/ui-select","common/modules/dialog","common/modules/xeditable-civi","common/services/angular-date/date-format","common/directives/loading","appraisals/controllers/appraisals-ctrl","appraisals/controllers/appraisals-dashboard-ctrl","appraisals/controllers/appraisal-cycle-ctrl","appraisals/controllers/appraisal-cycle-appraisals-ctrl","appraisals/controllers/appraisal-cycle-summary-ctrl","appraisals/controllers/modals/basic-modal-ctrl","appraisals/controllers/modals/appraisal-cycle-modal-ctrl","appraisals/controllers/modals/access-settings-modal-ctrl","appraisals/controllers/modals/edit-dates-modal-ctrl","appraisals/controllers/modals/add-contacts-modal-ctrl","appraisals/controllers/modals/view-cycle-modal-ctrl","appraisals/controllers/modals/send-notification-reminder-modal-ctrl","appraisals/controllers/modals/notification-recipients-modal-ctrl","appraisals/directives/show-more","appraisals/directives/grades-chart","appraisals/models/appraisal","appraisals/models/appraisal-cycle","appraisals/models/instances/appraisal-instance","appraisals/models/instances/appraisal-cycle-instance","appraisals/vendor/ui-router"],function(e,t){return t.module("appraisals",["ngResource","ui.router","ui.bootstrap","common.angularDate","common.dialog","common.directives","appraisals.controllers","appraisals.directives","appraisals.models","ui.select","xeditable-civi"]).config(["$stateProvider","$urlRouterProvider","$resourceProvider","$httpProvider","$logProvider",function(t,n,r,i,s){s.debugEnabled(!0),r.defaults.stripTrailingSlashes=!1,i.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e(n,t)}]).run(["$log","editableOptions","editableThemes",function(e,t,n){e.debug("app.run"),t.theme="bs3"}]),t}),function(){var e=CRM.vars.appraisals.baseURL+"/js/src/appraisals";require.config({urlArgs:"bust="+(new Date).getTime(),paths:{appraisals:e,"appraisals/vendor/ui-router":e+"/vendor/angular-ui-router.min"}}),require(["appraisals/app"],function(e){e.bootstrap(document.querySelector("[data-appraisals-app]"),["appraisals"])})}(require);
/*!
angular-xeditable - 0.1.12
Edit-in-place for angular.js
Build date: 2016-04-14 
*/

/**
 * Bunch of useful filters for angularJS(with no external dependencies!)
 * @version v0.5.14 - 2016-12-06 * @link https://github.com/a8m/angular-filter
 * @author Ariel Mashraki <ariel@mashraki.co.il>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

angular.module("xeditable",[]).value("editableOptions",{theme:"default",icon_set:"default",buttons:"right",blurElem:"cancel",blurForm:"ignore",activate:"focus",isDisabled:!1,activationEvent:"click"}),angular.module("xeditable").directive("editableBsdate",["editableDirectiveFactory",function(e){return e({directiveName:"editableBsdate",inputTpl:"<div></div>",render:function(){this.parent.render.call(this);var e=angular.element('<input type="text" class="form-control" ng-model="$data"/>'),t=angular.element('<button type="button" class="btn btn-default"><i class="glyphicon glyphicon-calendar"></i></button>'),n=angular.element('<span class="input-group-btn"></span>');e.attr("uib-datepicker-popup",this.attrs.eDatepickerPopupXEditable||"yyyy/MM/dd"),e.attr("is-open",this.attrs.eIsOpen),e.attr("date-disabled",this.attrs.eDateDisabled),e.attr("uib-datepicker-popup",this.attrs.eDatepickerPopup),e.attr("min-date",this.attrs.eMinDate),e.attr("max-date",this.attrs.eMaxDate),e.attr("year-range",this.attrs.eYearRange||20),e.attr("show-button-bar",this.attrs.eShowButtonBar||!0),e.attr("current-text",this.attrs.eCurrentText||"Today"),e.attr("clear-text",this.attrs.eClearText||"Clear"),e.attr("close-text",this.attrs.eCloseText||"Done"),e.attr("close-on-date-selection",this.attrs.eCloseOnDateSelection||!0),e.attr("datepicker-append-to-body",this.attrs.eDatePickerAppendToBody||!1),e.attr("date-disabled",this.attrs.eDateDisabled),e.attr("name",this.attrs.eName),this.scope.dateOptions={formatDay:this.attrs.eFormatDay||"dd",formatMonth:this.attrs.eFormatMonth||"MMMM",formatYear:this.attrs.eFormatYear||"yyyy",formatDayHeader:this.attrs.eFormatDayHeader||"EEE",formatDayTitle:this.attrs.eFormatDayTitle||"MMMM yyyy",formatMonthTitle:this.attrs.eFormatMonthTitle||"yyyy",showWeeks:!this.attrs.eShowWeeks||"true"===this.attrs.eShowWeeks.toLowerCase(),startingDay:this.attrs.eStartingDay||0,minMode:this.attrs.eMinMode||"day",maxMode:this.attrs.eMaxMode||"year",initDate:this.attrs.eInitDate||new Date,datepickerMode:this.attrs.eDatepickerMode||"day"},e.attr("datepicker-options","dateOptions"),t.attr("ng-click",this.attrs.eNgClick),n.append(t),this.inputEl.prepend(e),this.inputEl.append(n),this.inputEl.removeAttr("class"),this.inputEl.removeAttr("ng-click"),this.inputEl.removeAttr("is-open"),this.inputEl.removeAttr("init-date"),this.inputEl.removeAttr("datepicker-popup"),this.inputEl.removeAttr("required"),this.inputEl.removeAttr("ng-model"),this.inputEl.removeAttr("date-picker-append-to-body"),this.inputEl.removeAttr("name"),this.inputEl.attr("class","input-group")}})}]),angular.module("xeditable").directive("editableBstime",["editableDirectiveFactory",function(e){return e({directiveName:"editableBstime",inputTpl:"<uib-timepicker></uib-timepicker>",render:function(){this.parent.render.call(this);var e=angular.element('<div class="well well-small" style="display:inline-block;"></div>');e.attr("ng-model",this.inputEl.attr("ng-model")),this.inputEl.removeAttr("ng-model"),this.attrs.eNgChange&&(e.attr("ng-change",this.inputEl.attr("ng-change")),this.inputEl.removeAttr("ng-change")),this.inputEl.wrap(e)}})}]),angular.module("xeditable").directive("editableCheckbox",["editableDirectiveFactory",function(e){return e({directiveName:"editableCheckbox",inputTpl:'<input type="checkbox">',render:function(){this.parent.render.call(this),this.attrs.eTitle&&(this.inputEl.wrap("<label></label>"),this.inputEl.parent().append(this.attrs.eTitle))},autosubmit:function(){var e=this;e.inputEl.bind("change",function(){setTimeout(function(){e.scope.$apply(function(){e.scope.$form.$submit()})},500)})}})}]),angular.module("xeditable").directive("editableChecklist",["editableDirectiveFactory","editableNgOptionsParser",function(e,t){return e({directiveName:"editableChecklist",inputTpl:"<span></span>",useCopy:!0,render:function(){this.parent.render.call(this);var e=t(this.attrs.eNgOptions),n='<label ng-repeat="'+e.ngRepeat+'"><input type="checkbox" checklist-model="$parent.$data" checklist-value="'+e.locals.valueFn+'"><span ng-bind="'+e.locals.displayFn+'"></span></label>';this.inputEl.removeAttr("ng-model"),this.inputEl.removeAttr("ng-options"),this.inputEl.html(n)}})}]),angular.module("xeditable").directive("editableCombodate",["editableDirectiveFactory","editableCombodate",function(e,t){return e({directiveName:"editableCombodate",inputTpl:'<input type="text">',render:function(){this.parent.render.call(this);var e={value:new Date(this.scope.$data)},n=this;angular.forEach(["format","template","minYear","maxYear","yearDescending","minuteStep","secondStep","firstItem","errorClass","customClass","roundTime","smartDays"],function(t){var r="e"+t.charAt(0).toUpperCase()+t.slice(1);r in n.attrs&&(e[t]=n.attrs[r])});var r=t.getInstance(this.inputEl,e);r.$widget.find("select").bind("change",function(e){n.scope.$data=new Date(r.getValue()).toISOString()})}})}]),function(){var e="text|password|email|tel|number|url|search|color|date|datetime|time|month|week|file".split("|");angular.forEach(e,function(e){var t="editable"+e.charAt(0).toUpperCase()+e.slice(1);angular.module("xeditable").directive(t,["editableDirectiveFactory",function(n){return n({directiveName:t,inputTpl:'<input type="'+e+'">'})}])}),angular.module("xeditable").directive("editableRange",["editableDirectiveFactory",function(e){return e({directiveName:"editableRange",inputTpl:'<input type="range" id="range" name="range">',render:function(){this.parent.render.call(this),this.inputEl.after("<output>{{$data}}</output>")}})}])}(),angular.module("xeditable").directive("editableRadiolist",["editableDirectiveFactory","editableNgOptionsParser",function(e,t){return e({directiveName:"editableRadiolist",inputTpl:"<span></span>",render:function(){this.parent.render.call(this);var e=t(this.attrs.eNgOptions),n='<label ng-repeat="'+e.ngRepeat+'"><input type="radio" ng-disabled="'+this.attrs.eNgDisabled+'" ng-model="$parent.$data" value="{{'+e.locals.valueFn+'}}"><span ng-bind="'+e.locals.displayFn+'"></span></label>';this.inputEl.removeAttr("ng-model"),this.inputEl.removeAttr("ng-options"),this.inputEl.html(n)},autosubmit:function(){var e=this;e.inputEl.bind("change",function(){setTimeout(function(){e.scope.$apply(function(){e.scope.$form.$submit()})},500)})}})}]),angular.module("xeditable").directive("editableSelect",["editableDirectiveFactory",function(e){return e({directiveName:"editableSelect",inputTpl:"<select></select>",autosubmit:function(){var e=this;e.inputEl.bind("change",function(){e.scope.$apply(function(){e.scope.$form.$submit()})})}})}]),angular.module("xeditable").directive("editableTextarea",["editableDirectiveFactory",function(e){return e({directiveName:"editableTextarea",inputTpl:"<textarea></textarea>",addListeners:function(){var e=this;e.parent.addListeners.call(e),e.single&&"no"!==e.buttons&&e.autosubmit()},autosubmit:function(){var e=this;e.inputEl.bind("keydown",function(t){(t.ctrlKey||t.metaKey)&&13===t.keyCode&&e.scope.$apply(function(){e.scope.$form.$submit()})})}})}]),angular.module("xeditable").directive("editableUiSelect",["editableDirectiveFactory",function(e){var t=function(e,t){var n=angular.element("<"+e+"/>");n.html(t.html());for(var r=t[0].attributes,a=0;a<r.length;++a)n.attr(r.item(a).nodeName,r.item(a).value);return n},n=null,r=null,a=e({directiveName:"editableUiSelect",inputTpl:"<ui-select></ui-select>",render:function(){this.parent.render.call(this),this.inputEl.append(t("ui-select-match",n)),this.inputEl.append(t("ui-select-choices",r)),this.inputEl.removeAttr("ng-model"),this.inputEl.attr("ng-model","$parent.$data")}}),i=a.link;return a.link=function(e,t,a,o){var s=t.find("editable-ui-select-match"),l=t.find("editable-ui-select-choices");return n=s.clone(),r=l.clone(),s.remove(),l.remove(),i(e,t,a,o)},a}]),angular.module("xeditable").factory("editableController",["$q","editableUtils",function(e,t){function n(e,n,r,a,i,o,s,l,u,c){var d,f,p=this;p.scope=e,p.elem=r,p.attrs=n,p.inputEl=null,p.editorEl=null,p.single=!0,p.error="",p.theme=i[s.theme]||i.default,p.parent={},p.icon_set="default"===s.icon_set?o.default[s.theme]:o.external[s.icon_set],p.inputTpl="",p.directiveName="",p.useCopy=!1,p.single=null,p.buttons="right",p.init=function(t){if(p.single=t,p.name=n.eName||n[p.directiveName],!n[p.directiveName])throw"You should provide value for `"+p.directiveName+"` in editable element!";d=a(n[p.directiveName]),p.single?p.buttons=p.attrs.buttons||s.buttons:p.buttons="no",n.eName&&p.scope.$watch("$data",function(e){p.scope.$form.$data[n.eName]=e}),n.onshow&&(p.onshow=function(){return p.catchError(a(n.onshow)(e))}),n.onhide&&(p.onhide=function(){return a(n.onhide)(e)}),n.oncancel&&(p.oncancel=function(){return a(n.oncancel)(e)}),n.onbeforesave&&(p.onbeforesave=function(){return p.catchError(a(n.onbeforesave)(e))}),n.onaftersave&&(p.onaftersave=function(){return p.catchError(a(n.onaftersave)(e))}),e.$parent.$watch(n[p.directiveName],function(e,t){p.setLocalValue(),p.handleEmpty()})},p.render=function(){var e=p.theme;p.inputEl=angular.element(p.inputTpl),p.controlsEl=angular.element(e.controlsTpl),p.controlsEl.append(p.inputEl),"no"!==p.buttons&&(p.buttonsEl=angular.element(e.buttonsTpl),p.submitEl=angular.element(e.submitTpl),p.cancelEl=angular.element(e.cancelTpl),p.icon_set&&(p.submitEl.find("span").addClass(p.icon_set.ok),p.cancelEl.find("span").addClass(p.icon_set.cancel)),p.buttonsEl.append(p.submitEl).append(p.cancelEl),p.controlsEl.append(p.buttonsEl),p.inputEl.addClass("editable-has-buttons")),p.errorEl=angular.element(e.errorTpl),p.controlsEl.append(p.errorEl),p.editorEl=angular.element(p.single?e.formTpl:e.noformTpl),p.editorEl.append(p.controlsEl);for(var r in n.$attr)if(!(r.length<=1)){var a=!1,i=r.substring(1,2);if("e"===r.substring(0,1)&&i===i.toUpperCase()&&(a=r.substring(1),"Form"!==a&&"NgSubmit"!==a)){a=a.substring(0,1).toLowerCase()+t.camelToDash(a.substring(1));var o="value"!==a&&""===n[r]?a:n[r];p.inputEl.attr(a,o)}}p.inputEl.addClass("editable-input"),p.inputEl.attr("ng-model","$data"),p.editorEl.addClass(t.camelToDash(p.directiveName)),p.single&&(p.editorEl.attr("editable-form","$form"),p.editorEl.attr("blur",p.attrs.blur||("no"===p.buttons?"cancel":s.blurElem))),angular.isFunction(e.postrender)&&e.postrender.call(p)},p.setLocalValue=function(){p.scope.$data=p.useCopy?angular.copy(d(e.$parent)):d(e.$parent)},p.show=function(){return p.setLocalValue(),p.render(),r.after(p.editorEl),u(p.editorEl)(e),p.addListeners(),r.addClass("editable-hide"),p.onshow()},p.hide=function(){return p.editorEl.remove(),r.removeClass("editable-hide"),p.onhide()},p.cancel=function(){p.oncancel()},p.addListeners=function(){p.inputEl.bind("keyup",function(e){if(p.single)switch(e.keyCode){case 27:p.scope.$apply(function(){p.scope.$form.$cancel()})}}),p.single&&"no"===p.buttons&&p.autosubmit(),p.editorEl.bind("click",function(e){e.which&&1!==e.which||p.scope.$form.$visible&&(p.scope.$form._clicked=!0)})},p.setWaiting=function(e){e?(f=!p.inputEl.attr("disabled")&&!p.inputEl.attr("ng-disabled")&&!p.inputEl.attr("ng-enabled"),f&&(p.inputEl.attr("disabled","disabled"),p.buttonsEl&&p.buttonsEl.find("button").attr("disabled","disabled"))):f&&(p.inputEl.removeAttr("disabled"),p.buttonsEl&&p.buttonsEl.find("button").removeAttr("disabled"))},p.activate=function(e,t){setTimeout(function(){var n=p.inputEl[0];"focus"===s.activate&&n.focus&&(e&&(t=t||e,n.onfocus=function(){var n=this;setTimeout(function(){n.setSelectionRange(e,t)})}),n.focus()),"select"===s.activate&&n.select&&n.select()},0)},p.setError=function(t){angular.isObject(t)||(e.$error=t,p.error=t)},p.catchError=function(e,t){return angular.isObject(e)&&t!==!0?c.when(e).then(angular.bind(this,function(e){this.catchError(e,!0)}),angular.bind(this,function(e){this.catchError(e,!0)})):t&&angular.isObject(e)&&e.status&&200!==e.status&&e.data&&angular.isString(e.data)?(this.setError(e.data),e=e.data):angular.isString(e)&&this.setError(e),e},p.save=function(){d.assign(e.$parent,p.useCopy?angular.copy(p.scope.$data):p.scope.$data)},p.handleEmpty=function(){var t=d(e.$parent),n=null===t||void 0===t||""===t||angular.isArray(t)&&0===t.length;r.toggleClass("editable-empty",n)},p.autosubmit=angular.noop,p.onshow=angular.noop,p.onhide=angular.noop,p.oncancel=angular.noop,p.onbeforesave=angular.noop,p.onaftersave=angular.noop}return n.$inject=["$scope","$attrs","$element","$parse","editableThemes","editableIcons","editableOptions","$rootScope","$compile","$q"],n}]),angular.module("xeditable").factory("editableDirectiveFactory",["$parse","$compile","editableThemes","$rootScope","$document","editableController","editableFormController","editableOptions",function(e,t,n,r,a,i,o,s){return function(t){return{restrict:"A",scope:!0,require:[t.directiveName,"?^form"],controller:i,link:function(n,i,l,u){var c,d=u[0],f=!1;if(u[1])c=u[1],f=void 0===l.eSingle;else if(l.eForm){var p=e(l.eForm)(n);if(p)c=p,f=!0;else for(var m=0;m<a[0].forms.length;m++)if(a[0].forms[m].name===l.eForm){c=null,f=!0;break}}angular.forEach(t,function(e,t){void 0!==d[t]&&(d.parent[t]=d[t])}),angular.extend(d,t);var h=angular.isDefined(l.editDisabled)?n.$eval(l.editDisabled):s.isDisabled;if(!h)if(d.init(!f),n.$editable=d,i.addClass("editable"),f)if(c){if(n.$form=c,!n.$form.$addEditable)throw"Form with editable elements should have `editable-form` attribute.";n.$form.$addEditable(d)}else r.$$editableBuffer=r.$$editableBuffer||{},r.$$editableBuffer[l.eForm]=r.$$editableBuffer[l.eForm]||[],r.$$editableBuffer[l.eForm].push(d),n.$form=null;else n.$form=o(),n.$form.$addEditable(d),l.eForm&&(n.$parent[l.eForm]=n.$form),(!l.eForm||l.eClickable)&&(i.addClass("editable-click"),i.bind(s.activationEvent,function(e){e.preventDefault(),e.editable=d,n.$apply(function(){n.$form.$show()})}))}}}}]),angular.module("xeditable").factory("editableFormController",["$parse","$document","$rootScope","editablePromiseCollection","editableUtils",function(e,t,n,r,a){var i=[],o=function(e,t){if(t==e)return!0;for(var n=t.parentNode;null!==n;){if(n==e)return!0;n=n.parentNode}return!1},s=function(e,t){var n=!0,r=e.$editables;return angular.forEach(r,function(e){var r=e.editorEl[0];o(r,t.target)&&(n=!1)}),n};t.bind("click",function(e){if(!e.which||1===e.which){for(var t=[],r=[],a=0;a<i.length;a++)i[a]._clicked?i[a]._clicked=!1:i[a].$waiting||("cancel"===i[a]._blur&&s(i[a],e)&&t.push(i[a]),"submit"===i[a]._blur&&s(i[a],e)&&r.push(i[a]));(t.length||r.length)&&n.$apply(function(){angular.forEach(t,function(e){e.$cancel()}),angular.forEach(r,function(e){e.$submit()})})}}),n.$on("closeEdit",function(){for(var e=0;e<i.length;e++)i[e].$hide()});var l={$addEditable:function(e){this.$editables.push(e),e.elem.bind("$destroy",angular.bind(this,this.$removeEditable,e)),e.scope.$form||(e.scope.$form=this),this.$visible&&e.catchError(e.show()),e.catchError(e.setWaiting(this.$waiting))},$removeEditable:function(e){for(var t=0;t<this.$editables.length;t++)if(this.$editables[t]===e)return void this.$editables.splice(t,1)},$show:function(){if(!this.$visible){this.$visible=!0;var e=r();e.when(this.$onshow()),this.$setError(null,""),angular.forEach(this.$editables,function(t){e.when(t.show())}),e.then({onWait:angular.bind(this,this.$setWaiting),onTrue:angular.bind(this,this.$activate),onFalse:angular.bind(this,this.$activate),onString:angular.bind(this,this.$activate)}),setTimeout(angular.bind(this,function(){this._clicked=!1,-1===a.indexOf(i,this)&&i.push(this)}),0)}},$activate:function(e){var t;if(this.$editables.length){if(angular.isString(e))for(t=0;t<this.$editables.length;t++)if(this.$editables[t].name===e)return void this.$editables[t].activate();for(t=0;t<this.$editables.length;t++)if(this.$editables[t].error)return void this.$editables[t].activate();this.$editables[0].activate(this.$editables[0].elem[0].selectionStart,this.$editables[0].elem[0].selectionEnd)}},$hide:function(){this.$visible&&(this.$visible=!1,this.$onhide(),angular.forEach(this.$editables,function(e){e.hide()}),a.arrayRemove(i,this))},$cancel:function(){this.$visible&&(this.$oncancel(),angular.forEach(this.$editables,function(e){e.cancel()}),this.$hide())},$setWaiting:function(e){this.$waiting=!!e,angular.forEach(this.$editables,function(t){t.setWaiting(!!e)})},$setError:function(e,t){angular.forEach(this.$editables,function(n){e&&n.name!==e||n.setError(t)})},$submit:function(){function e(e){var t=r();t.when(this.$onbeforesave()),t.then({onWait:angular.bind(this,this.$setWaiting),onTrue:e?angular.bind(this,this.$save):angular.bind(this,this.$hide),onFalse:angular.bind(this,this.$hide),onString:angular.bind(this,this.$activate)})}if(!this.$waiting){this.$setError(null,"");var t=r();angular.forEach(this.$editables,function(e){t.when(e.onbeforesave())}),t.then({onWait:angular.bind(this,this.$setWaiting),onTrue:angular.bind(this,e,!0),onFalse:angular.bind(this,e,!1),onString:angular.bind(this,this.$activate)})}},$save:function(){angular.forEach(this.$editables,function(e){e.save()});var e=r();e.when(this.$onaftersave()),angular.forEach(this.$editables,function(t){e.when(t.onaftersave())}),e.then({onWait:angular.bind(this,this.$setWaiting),onTrue:angular.bind(this,this.$hide),onFalse:angular.bind(this,this.$hide),onString:angular.bind(this,this.$activate)})},$onshow:angular.noop,$oncancel:angular.noop,$onhide:angular.noop,$onbeforesave:angular.noop,$onaftersave:angular.noop};return function(){return angular.extend({$editables:[],$visible:!1,$waiting:!1,$data:{},_clicked:!1,_blur:null},l)}}]),angular.module("xeditable").directive("editableForm",["$rootScope","$parse","editableFormController","editableOptions",function(e,t,n,r){return{restrict:"A",require:["form"],compile:function(){return{pre:function(t,r,a,i){var o,s=i[0];a.editableForm?t[a.editableForm]&&t[a.editableForm].$show?(o=t[a.editableForm],angular.extend(s,o)):(o=n(),t[a.editableForm]=o,angular.extend(o,s)):(o=n(),angular.extend(s,o));var l=e.$$editableBuffer,u=s.$name;u&&l&&l[u]&&(angular.forEach(l[u],function(e){o.$addEditable(e)}),delete l[u])},post:function(e,n,a,i){var o;o=a.editableForm&&e[a.editableForm]&&e[a.editableForm].$show?e[a.editableForm]:i[0],a.onshow&&(o.$onshow=angular.bind(o,t(a.onshow),e)),a.onhide&&(o.$onhide=angular.bind(o,t(a.onhide),e)),a.oncancel&&(o.$oncancel=angular.bind(o,t(a.oncancel),e)),a.shown&&t(a.shown)(e)&&o.$show(),o._blur=a.blur||r.blurForm,a.ngSubmit||a.submit||(a.onbeforesave&&(o.$onbeforesave=function(){return t(a.onbeforesave)(e,{$data:o.$data})}),a.onaftersave&&(o.$onaftersave=function(){return t(a.onaftersave)(e,{$data:o.$data})}),n.bind("submit",function(t){t.preventDefault(),e.$apply(function(){o.$submit()})})),n.bind("click",function(e){e.which&&1!==e.which||o.$visible&&(o._clicked=!0)})}}}}}]),angular.module("xeditable").factory("editablePromiseCollection",["$q",function(e){function t(){return{promises:[],hasFalse:!1,hasString:!1,when:function(t,n){if(t===!1)this.hasFalse=!0;else if(!n&&angular.isObject(t))this.promises.push(e.when(t));else{if(!angular.isString(t))return;this.hasString=!0}},then:function(t){function n(){s.hasString||s.hasFalse?!s.hasString&&s.hasFalse?a():i():r()}t=t||{};var r=t.onTrue||angular.noop,a=t.onFalse||angular.noop,i=t.onString||angular.noop,o=t.onWait||angular.noop,s=this;this.promises.length?(o(!0),e.all(this.promises).then(function(e){o(!1),angular.forEach(e,function(e){s.when(e,!0)}),n()},function(e){o(!1),i()})):n()}}}return t}]),angular.module("xeditable").factory("editableUtils",[function(){return{indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1},arrayRemove:function(e,t){var n=this.indexOf(e,t);return n>=0&&e.splice(n,1),t},camelToDash:function(e){var t=/[A-Z]/g;return e.replace(t,function(e,t){return(t?"-":"")+e.toLowerCase()})},dashToCamel:function(e){var t=/([\:\-\_]+(.))/g,n=/^moz([A-Z])/;return e.replace(t,function(e,t,n,r){return r?n.toUpperCase():n}).replace(n,"Moz$1")}}}]),angular.module("xeditable").factory("editableNgOptionsParser",[function(){function e(e){var n;if(!(n=e.match(t)))throw"ng-options parse error";var r,a=n[2]||n[1],i=n[4]||n[6],o=n[5],s=(n[3]||"",n[2]?n[1]:i),l=n[7],u=n[8],c=u?n[8]:null;return void 0===o?(r=i+" in "+l,void 0!==u&&(r+=" track by "+c)):r="("+o+", "+i+") in "+l,{ngRepeat:r,locals:{valueName:i,keyName:o,valueFn:s,displayFn:a}}}var t=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return e}]),angular.module("xeditable").factory("editableCombodate",[function(){function e(e,t){if(this.$element=angular.element(e),"INPUT"!=this.$element[0].nodeName)throw"Combodate should be applied to INPUT element";var n=(new Date).getFullYear();this.defaults={format:"YYYY-MM-DD HH:mm",template:"D / MMM / YYYY   H : mm",value:null,minYear:1970,maxYear:n,yearDescending:!0,minuteStep:5,secondStep:1,firstItem:"empty",errorClass:null,customClass:"",roundTime:!0,smartDays:!0},this.options=angular.extend({},this.defaults,t),this.init()}return e.prototype={constructor:e,init:function(){if(this.map={day:["D","date"],month:["M","month"],year:["Y","year"],hour:["[Hh]","hours"],minute:["m","minutes"],second:["s","seconds"],ampm:["[Aa]",""]},this.$widget=angular.element('<span class="combodate"></span>').html(this.getTemplate()),this.initCombos(),this.options.smartDays){var e=this;this.$widget.find("select").bind("change",function(t){(angular.element(t.target).hasClass("month")||angular.element(t.target).hasClass("year"))&&e.fillCombo("day")})}this.$widget.find("select").css("width","auto"),this.$element.css("display","none").after(this.$widget),this.setValue(this.$element.val()||this.options.value)},getTemplate:function(){var e=this.options.template,t=this.options.customClass;return angular.forEach(this.map,function(t,n){t=t[0];var r=new RegExp(t+"+"),a=t.length>1?t.substring(1,2):t;e=e.replace(r,"{"+a+"}")}),e=e.replace(/ /g,"&nbsp;"),angular.forEach(this.map,function(n,r){n=n[0];var a=n.length>1?n.substring(1,2):n;e=e.replace("{"+a+"}",'<select class="'+r+" "+t+'"></select>')}),e},initCombos:function(){for(var e in this.map){var t=this.$widget[0].querySelectorAll("."+e);this["$"+e]=t.length?angular.element(t):null,this.fillCombo(e)}},fillCombo:function(e){var t=this["$"+e];if(t){var n="fill"+e.charAt(0).toUpperCase()+e.slice(1),r=this[n](),a=t.val();t.html("");for(var i=0;i<r.length;i++)t.append('<option value="'+r[i][0]+'">'+r[i][1]+"</option>");t.val(a)}},fillCommon:function(e){var t,n=[];if("name"===this.options.firstItem){t=moment.relativeTime||moment.langData()._relativeTime;var r="function"==typeof t[e]?t[e](1,!0,e,!1):t[e];r=r.split(" ").reverse()[0],n.push(["",r])}else"empty"===this.options.firstItem&&n.push(["",""]);return n},fillDay:function(){var e,t,n=this.fillCommon("d"),r=-1!==this.options.template.indexOf("DD"),a=31;if(this.options.smartDays&&this.$month&&this.$year){var i=parseInt(this.$month.val(),10),o=parseInt(this.$year.val(),10);isNaN(i)||isNaN(o)||(a=moment([o,i]).daysInMonth())}for(t=1;a>=t;t++)e=r?this.leadZero(t):t,n.push([t,e]);return n},fillMonth:function(){var e,t,n=this.fillCommon("M"),r=-1!==this.options.template.indexOf("MMMM"),a=-1!==this.options.template.indexOf("MMM"),i=-1!==this.options.template.indexOf("MM");for(t=0;11>=t;t++)e=r?moment().date(1).month(t).format("MMMM"):a?moment().date(1).month(t).format("MMM"):i?this.leadZero(t+1):t+1,n.push([t,e]);return n},fillYear:function(){var e,t,n=[],r=-1!==this.options.template.indexOf("YYYY");for(t=this.options.maxYear;t>=this.options.minYear;t--)e=r?t:(t+"").substring(2),n[this.options.yearDescending?"push":"unshift"]([t,e]);return n=this.fillCommon("y").concat(n)},fillHour:function(){var e,t,n=this.fillCommon("h"),r=-1!==this.options.template.indexOf("h"),a=(-1!==this.options.template.indexOf("H"),-1!==this.options.template.toLowerCase().indexOf("hh")),i=r?1:0,o=r?12:23;for(t=i;o>=t;t++)e=a?this.leadZero(t):t,n.push([t,e]);return n},fillMinute:function(){var e,t,n=this.fillCommon("m"),r=-1!==this.options.template.indexOf("mm");for(t=0;59>=t;t+=this.options.minuteStep)e=r?this.leadZero(t):t,n.push([t,e]);return n},fillSecond:function(){var e,t,n=this.fillCommon("s"),r=-1!==this.options.template.indexOf("ss");for(t=0;59>=t;t+=this.options.secondStep)e=r?this.leadZero(t):t,n.push([t,e]);return n},fillAmpm:function(){var e=-1!==this.options.template.indexOf("a"),t=(-1!==this.options.template.indexOf("A"),[["am",e?"am":"AM"],["pm",e?"pm":"PM"]]);return t},getValue:function(e){var t,n={},r=this,a=!1;return angular.forEach(this.map,function(e,t){if("ampm"!==t){var i="day"===t?1:0;return n[t]=r["$"+t]?parseInt(r["$"+t].val(),10):i,isNaN(n[t])?(a=!0,!1):void 0}}),a?"":(this.$ampm&&(12===n.hour?n.hour="am"===this.$ampm.val()?0:12:n.hour="am"===this.$ampm.val()?n.hour:n.hour+12),t=moment([n.year,n.month,n.day,n.hour,n.minute,n.second]),this.highlight(t),e=void 0===e?this.options.format:e,null===e?t.isValid()?t:null:t.isValid()?t.format(e):"")},setValue:function(e){function t(e,t){var n={};return angular.forEach(e.children("option"),function(e,r){var a=angular.element(e).attr("value");if(""!==a){var i=Math.abs(a-t);("undefined"==typeof n.distance||i<n.distance)&&(n={value:a,distance:i})}}),n.value}if(e){var n="string"==typeof e?moment(e,this.options.format,!0):moment(e),r=this,a={};n.isValid()&&(angular.forEach(this.map,function(e,t){"ampm"!==t&&(a[t]=n[e[1]]())}),this.$ampm&&(a.hour>=12?(a.ampm="pm",a.hour>12&&(a.hour-=12)):(a.ampm="am",0===a.hour&&(a.hour=12))),angular.forEach(a,function(e,n){r["$"+n]&&("minute"===n&&r.options.minuteStep>1&&r.options.roundTime&&(e=t(r["$"+n],e)),"second"===n&&r.options.secondStep>1&&r.options.roundTime&&(e=t(r["$"+n],e)),r["$"+n].val(e))}),this.options.smartDays&&this.fillCombo("day"),this.$element.val(n.format(this.options.format)).triggerHandler("change"))}},highlight:function(e){e.isValid()?this.options.errorClass?this.$widget.removeClass(this.options.errorClass):this.$widget.find("select").css("border-color",this.borderColor):this.options.errorClass?this.$widget.addClass(this.options.errorClass):(this.borderColor||(this.borderColor=this.$widget.find("select").css("border-color")),this.$widget.find("select").css("border-color","red"))},leadZero:function(e){return 9>=e?"0"+e:e},destroy:function(){this.$widget.remove(),this.$element.removeData("combodate").show()}},{getInstance:function(t,n){return new e(t,n)}}}]),angular.module("xeditable").factory("editableIcons",function(){var e={default:{bs2:{ok:"icon-ok icon-white",cancel:"icon-remove"},bs3:{ok:"glyphicon glyphicon-ok",cancel:"glyphicon glyphicon-remove"}},external:{"font-awesome":{ok:"fa fa-check",cancel:"fa fa-times"}}};return e}),angular.module("xeditable").factory("editableThemes",function(){var e={default:{formTpl:'<form class="editable-wrap"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<span class="editable-controls"></span>',inputTpl:"",errorTpl:'<div class="editable-error" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit">save</button>',cancelTpl:'<button type="button" ng-click="$form.$cancel()">cancel</button>'},bs2:{formTpl:'<form class="form-inline editable-wrap" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls controls control-group" ng-class="{\'error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error help-block" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit" class="btn btn-primary"><span></span></button>',cancelTpl:'<button type="button" class="btn" ng-click="$form.$cancel()"><span></span></button>'},bs3:{formTpl:'<form class="form-inline editable-wrap" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls form-group" ng-class="{\'has-error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error help-block" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit" class="btn btn-primary"><span></span></button>',cancelTpl:'<button type="button" class="btn btn-default" ng-click="$form.$cancel()"><span></span></button>',buttonsClass:"",inputClass:"",postrender:function(){switch(this.directiveName){case"editableText":case"editableSelect":case"editableTextarea":case"editableEmail":case"editableTel":case"editableNumber":case"editableUrl":case"editableSearch":case"editableDate":case"editableDatetime":case"editableBsdate":case"editableTime":case"editableMonth":case"editableWeek":case"editablePassword":if(this.inputEl.addClass("form-control"),this.theme.inputClass){if(this.inputEl.attr("multiple")&&("input-sm"===this.theme.inputClass||"input-lg"===this.theme.inputClass))break;this.inputEl.addClass(this.theme.inputClass)}break;case"editableCheckbox":this.editorEl.addClass("checkbox")}this.buttonsEl&&this.theme.buttonsClass&&this.buttonsEl.find("button").addClass(this.theme.buttonsClass)}},semantic:{formTpl:'<form class="editable-wrap ui form" ng-class="{\'error\': $error}" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls ui fluid input" ng-class="{\'error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error ui error message" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="mini ui buttons"></span>',submitTpl:'<button type="submit" class="ui primary button"><i class="ui check icon"></i></button>',cancelTpl:'<button type="button" class="ui button" ng-click="$form.$cancel()"><i class="ui cancel icon"></i></button>'}};return e}),!function(e,t,n){"use strict";function r(e){return R(e)?e:Object.keys(e).map(function(t){return e[t]})}function a(e){return null===e}function i(e,t){var r=Object.keys(e);return r.map(function(r){return t[r]!==n&&t[r]==e[r]}).indexOf(!1)==-1}function o(e,t){function n(e,t,n){for(var r=0;t+r<=e.length;){if(e.charAt(t+r)==n)return r;r++}return-1}for(var r=0,a=0;a<=t.length;a++){var i=n(e,r,t.charAt(a));if(i==-1)return!1;r+=i+1}return!0}function s(e,t,n){var r=0;return e.filter(function(e){var a=E(n)?r<t&&n(e):r<t;return r=a?r+1:r,a})}function l(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}function u(e,t,n){t=t||[];var r=Object.keys(e);return r.forEach(function(r){if(x(e[r])&&!R(e[r])){var a=n?n+"."+r:n;u(e[r],t,a||r)}else{var i=n?n+"."+r:r;t.push(i)}}),t}function c(e){return e&&e.$evalAsync&&e.$watch}function d(){return function(e,t){return e>t}}function f(){return function(e,t){return e>=t}}function p(){return function(e,t){return e<t}}function m(){return function(e,t){return e<=t}}function h(){return function(e,t){return e==t}}function b(){return function(e,t){return e!=t}}function v(){return function(e,t){return e===t}}function g(){return function(e,t){return e!==t}}function _(e){return function(t,n){return t=x(t)?r(t):t,!(!R(t)||C(n))&&t.some(function(t){return T(n)&&x(t)||D(n)?e(n)(t):t===n})}}function $(e,t){return t=t||0,t>=e.length?e:R(e[t])?$(e.slice(0,t).concat(e[t],e.slice(t+1)),t):$(e,t+1)}function y(e){return function(t,n){function a(e,t){return!C(t)&&e.some(function(e){return S(e,t)})}if(t=x(t)?r(t):t,!R(t))return t;var i=[],o=e(n);return C(n)?t.filter(function(e,t,n){return n.indexOf(e)===t}):t.filter(function(e){var t=o(e);return!a(i,t)&&(i.push(t),!0)})}}function w(e,t,n){return t?e+n+w(e,--t,n):e}var E=t.isDefined,C=t.isUndefined,D=t.isFunction,T=t.isString,j=t.isNumber,x=t.isObject,R=t.isArray,M=t.forEach,k=t.extend,F=t.copy,S=t.equals;String.prototype.contains||(String.prototype.contains=function(){return String.prototype.indexOf.apply(this,arguments)!==-1}),t.module("a8m.angular",[]).filter("isUndefined",function(){return function(e){return t.isUndefined(e)}}).filter("isDefined",function(){return function(e){return t.isDefined(e)}}).filter("isFunction",function(){return function(e){return t.isFunction(e)}}).filter("isString",function(){
return function(e){return t.isString(e)}}).filter("isNumber",function(){return function(e){return t.isNumber(e)}}).filter("isArray",function(){return function(e){return t.isArray(e)}}).filter("isObject",function(){return function(e){return t.isObject(e)}}).filter("isEqual",function(){return function(e,n){return t.equals(e,n)}}),t.module("a8m.conditions",[]).filter({isGreaterThan:d,">":d,isGreaterThanOrEqualTo:f,">=":f,isLessThan:p,"<":p,isLessThanOrEqualTo:m,"<=":m,isEqualTo:h,"==":h,isNotEqualTo:b,"!=":b,isIdenticalTo:v,"===":v,isNotIdenticalTo:g,"!==":g}),t.module("a8m.is-null",[]).filter("isNull",function(){return function(e){return a(e)}}),t.module("a8m.after-where",[]).filter("afterWhere",function(){return function(e,t){if(e=x(e)?r(e):e,!R(e)||C(t))return e;var n=e.map(function(e){return i(t,e)}).indexOf(!0);return e.slice(n===-1?0:n)}}),t.module("a8m.after",[]).filter("after",function(){return function(e,t){return e=x(e)?r(e):e,R(e)?e.slice(t):e}}),t.module("a8m.before-where",[]).filter("beforeWhere",function(){return function(e,t){if(e=x(e)?r(e):e,!R(e)||C(t))return e;var n=e.map(function(e){return i(t,e)}).indexOf(!0);return e.slice(0,n===-1?e.length:++n)}}),t.module("a8m.before",[]).filter("before",function(){return function(e,t){return e=x(e)?r(e):e,R(e)?e.slice(0,t?--t:t):e}}),t.module("a8m.chunk-by",["a8m.filter-watcher"]).filter("chunkBy",["filterWatcher",function(e){return function(t,n,r){function a(e,t){for(var n=[];e--;)n[e]=t;return n}function i(e,t,n){return R(e)?e.map(function(e,r,i){return r*=t,e=i.slice(r,r+t),!C(n)&&e.length<t?e.concat(a(t-e.length,n)):e}).slice(0,Math.ceil(e.length/t)):e}return e.isMemoized("chunkBy",arguments)||e.memoize("chunkBy",arguments,this,i(t,n,r))}}]),t.module("a8m.concat",[]).filter("concat",[function(){return function(e,t){if(C(t))return e;if(R(e))return x(t)?e.concat(r(t)):e.concat(t);if(x(e)){var n=r(e);return x(t)?n.concat(r(t)):n.concat(t)}return e}}]),t.module("a8m.contains",[]).filter({contains:["$parse",_],some:["$parse",_]}),t.module("a8m.count-by",[]).filter("countBy",["$parse",function(e){return function(t,n){var a,i={},o=e(n);return t=x(t)?r(t):t,!R(t)||C(n)?t:(t.forEach(function(e){a=o(e),i[a]||(i[a]=0),i[a]++}),i)}}]),t.module("a8m.defaults",[]).filter("defaults",["$parse",function(e){return function(t,n){if(t=x(t)?r(t):t,!R(t)||!x(n))return t;var a=u(n);return t.forEach(function(t){a.forEach(function(r){var a=e(r),i=a.assign;C(a(t))&&i(t,a(n))})}),t}}]),t.module("a8m.every",[]).filter("every",["$parse",function(e){return function(t,n){return t=x(t)?r(t):t,!(R(t)&&!C(n))||t.every(function(t){return x(t)||D(n)?e(n)(t):t===n})}}]),t.module("a8m.filter-by",[]).filter("filterBy",["$parse",function(e){return function(t,a,i,o){var s;return i=T(i)||j(i)?String(i).toLowerCase():n,t=x(t)?r(t):t,!R(t)||C(i)?t:t.filter(function(t){return a.some(function(n){if(~n.indexOf("+")){var r=n.replace(/\s+/g,"").split("+");s=r.map(function(n){return e(n)(t)}).join(" ")}else s=e(n)(t);return!(!T(s)&&!j(s))&&(s=String(s).toLowerCase(),o?s===i:s.contains(i))})})}}]),t.module("a8m.first",[]).filter("first",["$parse",function(e){return function(t){var a,i,o;return t=x(t)?r(t):t,R(t)?(o=Array.prototype.slice.call(arguments,1),a=j(o[0])?o[0]:1,i=j(o[0])?j(o[1])?n:o[1]:o[0],o.length?s(t,a,i?e(i):i):t[0]):t}}]),t.module("a8m.flatten",[]).filter("flatten",function(){return function(e,t){return t=t||!1,e=x(e)?r(e):e,R(e)?t?[].concat.apply([],e):$(e,0):e}}),t.module("a8m.fuzzy-by",[]).filter("fuzzyBy",["$parse",function(e){return function(t,n,a,i){var s,l,u=i||!1;return t=x(t)?r(t):t,!R(t)||C(n)||C(a)?t:(l=e(n),t.filter(function(e){return s=l(e),!!T(s)&&(s=u?s:s.toLowerCase(),a=u?a:a.toLowerCase(),o(s,a)!==!1)}))}}]),t.module("a8m.fuzzy",[]).filter("fuzzy",function(){return function(e,t,n){function a(e,t){var n,r,a=Object.keys(e);return 0<a.filter(function(a){return n=e[a],!!r||!!T(n)&&(n=i?n:n.toLowerCase(),r=o(n,t)!==!1)}).length}var i=n||!1;return e=x(e)?r(e):e,!R(e)||C(t)?e:(t=i?t:t.toLowerCase(),e.filter(function(e){return T(e)?(e=i?e:e.toLowerCase(),o(e,t)!==!1):!!x(e)&&a(e,t)}))}}),t.module("a8m.group-by",["a8m.filter-watcher"]).filter("groupBy",["$parse","filterWatcher",function(e,t){return function(n,r){function a(e,t){var n,r={};return M(e,function(e){n=t(e),r[n]||(r[n]=[]),r[n].push(e)}),r}return!x(n)||C(r)?n:t.isMemoized("groupBy",arguments)||t.memoize("groupBy",arguments,this,a(n,e(r)))}}]),t.module("a8m.is-empty",[]).filter("isEmpty",function(){return function(e){return x(e)?!r(e).length:!e.length}}),t.module("a8m.join",[]).filter("join",function(){return function(e,t){return C(e)||!R(e)?e:(C(t)&&(t=" "),e.join(t))}}),t.module("a8m.last",[]).filter("last",["$parse",function(e){return function(t){var a,i,o,l=F(t);return l=x(l)?r(l):l,R(l)?(o=Array.prototype.slice.call(arguments,1),a=j(o[0])?o[0]:1,i=j(o[0])?j(o[1])?n:o[1]:o[0],o.length?s(l.reverse(),a,i?e(i):i).reverse():l[l.length-1]):l}}]),t.module("a8m.map",[]).filter("map",["$parse",function(e){return function(t,n){return t=x(t)?r(t):t,!R(t)||C(n)?t:t.map(function(t){return e(n)(t)})}}]),t.module("a8m.omit",[]).filter("omit",["$parse",function(e){return function(t,n){return t=x(t)?r(t):t,!R(t)||C(n)?t:t.filter(function(t){return!e(n)(t)})}}]),t.module("a8m.pick",[]).filter("pick",["$parse",function(e){return function(t,n){return t=x(t)?r(t):t,!R(t)||C(n)?t:t.filter(function(t){return e(n)(t)})}}]),t.module("a8m.range",[]).filter("range",function(){return function(e,t,n,r,a){n=n||0,r=r||1;for(var i=0;i<parseInt(t);i++){var o=n+i*r;e.push(D(a)?a(o):o)}return e}}),t.module("a8m.remove-with",[]).filter("removeWith",function(){return function(e,t){return C(t)?e:(e=x(e)?r(e):e,e.filter(function(e){return!i(t,e)}))}}),t.module("a8m.remove",[]).filter("remove",function(){return function(e){e=x(e)?r(e):e;var t=Array.prototype.slice.call(arguments,1);return R(e)?e.filter(function(e){return!t.some(function(t){return S(t,e)})}):e}}),t.module("a8m.reverse",[]).filter("reverse",[function(){return function(e){return e=x(e)?r(e):e,T(e)?e.split("").reverse().join(""):R(e)?e.slice().reverse():e}}]),t.module("a8m.search-field",[]).filter("searchField",["$parse",function(e){return function(t){var n,a;t=x(t)?r(t):t;var i=Array.prototype.slice.call(arguments,1);return R(t)&&i.length?t.map(function(t){return a=i.map(function(r){return(n=e(r))(t)}).join(" "),k(t,{searchField:a})}):t}}]),t.module("a8m.to-array",[]).filter("toArray",function(){return function(e,t){return x(e)?t?Object.keys(e).map(function(t){return k(e[t],{$key:t})}):r(e):e}}),t.module("a8m.unique",[]).filter({unique:["$parse",y],uniq:["$parse",y]}),t.module("a8m.where",[]).filter("where",function(){return function(e,t){return C(t)?e:(e=x(e)?r(e):e,e.filter(function(e){return i(t,e)}))}}),t.module("a8m.xor",[]).filter("xor",["$parse",function(e){return function(t,n,a){function i(t,n){var r=e(a);return n.some(function(e){return a?S(r(e),r(t)):S(e,t)})}return a=a||!1,t=x(t)?r(t):t,n=x(n)?r(n):n,R(t)&&R(n)?t.concat(n).filter(function(e){return!(i(e,t)&&i(e,n))}):t}}]),t.module("a8m.math.abs",[]).filter("abs",function(){return function(e){return Math.abs(e)}}),t.module("a8m.math.byteFmt",[]).filter("byteFmt",function(){var e=[{str:"B",val:1024}];return["KB","MB","GB","TB","PB","EB","ZB","YB"].forEach(function(t,n){e.push({str:t,val:1024*e[n].val})}),function(t,n){if(j(n)&&isFinite(n)&&n%1===0&&n>=0&&j(t)&&isFinite(t)){for(var r=0;r<e.length-1&&t>=e[r].val;)r++;return t/=r>0?e[r-1].val:1,l(t,n)+" "+e[r].str}return"NaN"}}),t.module("a8m.math.degrees",[]).filter("degrees",function(){return function(e,t){if(j(t)&&isFinite(t)&&t%1===0&&t>=0&&j(e)&&isFinite(e)){var n=180*e/Math.PI;return Math.round(n*Math.pow(10,t))/Math.pow(10,t)}return"NaN"}}),t.module("a8m.math.kbFmt",[]).filter("kbFmt",function(){var e=[{str:"KB",val:1024}];return["MB","GB","TB","PB","EB","ZB","YB"].forEach(function(t,n){e.push({str:t,val:1024*e[n].val})}),function(t,n){if(j(n)&&isFinite(n)&&n%1===0&&n>=0&&j(t)&&isFinite(t)){for(var r=0;r<e.length-1&&t>=e[r].val;)r++;return t/=r>0?e[r-1].val:1,l(t,n)+" "+e[r].str}return"NaN"}}),t.module("a8m.math.max",[]).filter("max",["$parse",function(e){function t(t,n){var r=t.map(function(t){return e(n)(t)});return r.indexOf(Math.max.apply(Math,r))}return function(e,n){return R(e)?C(n)?Math.max.apply(Math,e):e[t(e,n)]:e}}]),t.module("a8m.math.min",[]).filter("min",["$parse",function(e){function t(t,n){var r=t.map(function(t){return e(n)(t)});return r.indexOf(Math.min.apply(Math,r))}return function(e,n){return R(e)?C(n)?Math.min.apply(Math,e):e[t(e,n)]:e}}]),t.module("a8m.math.percent",[]).filter("percent",function(){return function(e,t,n){var r=T(e)?Number(e):e;return t=t||100,n=n||!1,!j(r)||isNaN(r)?e:n?Math.round(r/t*100):r/t*100}}),t.module("a8m.math.radians",[]).filter("radians",function(){return function(e,t){if(j(t)&&isFinite(t)&&t%1===0&&t>=0&&j(e)&&isFinite(e)){var n=3.14159265359*e/180;return Math.round(n*Math.pow(10,t))/Math.pow(10,t)}return"NaN"}}),t.module("a8m.math.radix",[]).filter("radix",function(){return function(e,t){var n=/^[2-9]$|^[1-2]\d$|^3[0-6]$/;return j(e)&&n.test(t)?e.toString(t).toUpperCase():e}}),t.module("a8m.math.shortFmt",[]).filter("shortFmt",function(){return function(e,t){return j(t)&&isFinite(t)&&t%1===0&&t>=0&&j(e)&&isFinite(e)?e<1e3?""+e:e<1e6?l(e/1e3,t)+" K":e<1e9?l(e/1e6,t)+" M":l(e/1e9,t)+" B":"NaN"}}),t.module("a8m.math.sum",[]).filter("sum",function(){return function(e,t){return R(e)?e.reduce(function(e,t){return e+t},t||0):e}}),t.module("a8m.ends-with",[]).filter("endsWith",function(){return function(e,t,n){var r,a=n||!1;return!T(e)||C(t)?e:(e=a?e:e.toLowerCase(),r=e.length-t.length,e.indexOf(a?t:t.toLowerCase(),r)!==-1)}}),t.module("a8m.latinize",[]).filter("latinize",[function(){function e(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return n[e]||e})}for(var t=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"OE",letters:"Œ"},{base:"oe",letters:"œ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],n={},r=0;r<t.length;r++)for(var a=t[r].letters.split(""),i=0;i<a.length;i++)n[a[i]]=t[r].base;return function(t){return T(t)?e(t):t}}]),t.module("a8m.ltrim",[]).filter("ltrim",function(){return function(e,t){var n=t||"\\s";return T(e)?e.replace(new RegExp("^"+n+"+"),""):e}}),t.module("a8m.match",[]).filter("match",function(){return function(e,t,n){var r=new RegExp(t,n);return T(e)?e.match(r):null}}),t.module("a8m.repeat",[]).filter("repeat",[function(){return function(e,t,n){var r=~~t;return T(e)&&r?w(e,--t,n||""):e}}]),t.module("a8m.rtrim",[]).filter("rtrim",function(){return function(e,t){var n=t||"\\s";return T(e)?e.replace(new RegExp(n+"+$"),""):e}}),t.module("a8m.slugify",[]).filter("slugify",[function(){return function(e,t){var n=C(t)?"-":t;return T(e)?e.toLowerCase().replace(/\s+/g,n):e}}]),t.module("a8m.starts-with",[]).filter("startsWith",function(){return function(e,t,n){var r=n||!1;return!T(e)||C(t)?e:(e=r?e:e.toLowerCase(),!e.indexOf(r?t:t.toLowerCase()))}}),t.module("a8m.stringular",[]).filter("stringular",function(){return function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,n){return C(t[n])?e:t[n]})}}),t.module("a8m.strip-tags",[]).filter("stripTags",function(){return function(e){return T(e)?e.replace(/<\S[^><]*>/g,""):e}}),t.module("a8m.test",[]).filter("test",function(){return function(e,t,n){var r=new RegExp(t,n);return T(e)?r.test(e):e}}),t.module("a8m.trim",[]).filter("trim",function(){return function(e,t){var n=t||"\\s";return T(e)?e.replace(new RegExp("^"+n+"+|"+n+"+$","g"),""):e}}),t.module("a8m.truncate",[]).filter("truncate",function(){return function(e,t,n,r){return t=C(t)?e.length:t,r=r||!1,n=n||"",!T(e)||e.length<=t?e:e.substring(0,r?e.indexOf(" ",t)===-1?e.length:e.indexOf(" ",t):t)+n}}),t.module("a8m.ucfirst",[]).filter("ucfirst",[function(){return function(e){return T(e)?e.split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.substring(1)}).join(" "):e}}]),t.module("a8m.uri-component-encode",[]).filter("uriComponentEncode",["$window",function(e){return function(t){return T(t)?e.encodeURIComponent(t):t}}]),t.module("a8m.uri-encode",[]).filter("uriEncode",["$window",function(e){return function(t){return T(t)?e.encodeURI(t):t}}]),t.module("a8m.wrap",[]).filter("wrap",function(){return function(e,t,n){return T(e)&&E(t)?[t,e,n||t].join(""):e}}),t.module("a8m.filter-watcher",[]).provider("filterWatcher",function(){this.$get=["$window","$rootScope",function(e,t){function n(t,n){function r(){var t=[];return function(n,r){if(x(r)&&!a(r)){if(~t.indexOf(r))return"[Circular]";t.push(r)}return e==r?"$WINDOW":e.document==r?"$DOCUMENT":c(r)?"$SCOPE":r}}return[t,JSON.stringify(n,r())].join("#").replace(/"/g,"")}function r(e){var t=e.targetScope.$id;M(d[t],function(e){delete u[e]}),delete d[t]}function i(){f(function(){t.$$phase||(u={})},2e3)}function o(e,t){var n=e.$id;return C(d[n])&&(e.$on("$destroy",r),d[n]=[]),d[n].push(t)}function s(e,t){var r=n(e,t);return u[r]}function l(e,t,r,a){var s=n(e,t);return u[s]=a,c(r)?o(r,s):i(),a}var u={},d={},f=e.setTimeout;return{isMemoized:s,memoize:l}}]}),t.module("angular.filter",["a8m.ucfirst","a8m.uri-encode","a8m.uri-component-encode","a8m.slugify","a8m.latinize","a8m.strip-tags","a8m.stringular","a8m.truncate","a8m.starts-with","a8m.ends-with","a8m.wrap","a8m.trim","a8m.ltrim","a8m.rtrim","a8m.repeat","a8m.test","a8m.match","a8m.to-array","a8m.concat","a8m.contains","a8m.unique","a8m.is-empty","a8m.after","a8m.after-where","a8m.before","a8m.before-where","a8m.defaults","a8m.where","a8m.reverse","a8m.remove","a8m.remove-with","a8m.group-by","a8m.count-by","a8m.chunk-by","a8m.search-field","a8m.fuzzy-by","a8m.fuzzy","a8m.omit","a8m.pick","a8m.every","a8m.filter-by","a8m.xor","a8m.map","a8m.first","a8m.last","a8m.flatten","a8m.join","a8m.range","a8m.math.max","a8m.math.min","a8m.math.abs","a8m.math.percent","a8m.math.radix","a8m.math.sum","a8m.math.degrees","a8m.math.radians","a8m.math.byteFmt","a8m.math.kbFmt","a8m.math.shortFmt","a8m.angular","a8m.conditions","a8m.is-null","a8m.filter-watcher"])}(window,window.angular),define("job-roles/controllers/controllers",["common/angular"],function(e){"use strict";return e.module("hrjobroles.controllers",[])}),define("job-roles/directives/directives",["common/angular"],function(e){"use strict";return e.module("hrjobroles.directives",[])}),define("job-roles/filters/filters",["common/angular"],function(e){"use strict";return e.module("hrjobroles.filters",[])}),define("job-roles/services/services",["common/angular"],function(e){"use strict";return e.module("hrjobroles.services",[])}),define("job-roles/controllers/hr-job-roles-controller",["common/angular","job-roles/controllers/controllers","common/moment","common/lodash","common/filters/angular-date/format-date"],function(e,t,n,r){"use strict";t.controller("HRJobRolesController",["$scope","$log","$routeParams","$route","$uibModal","$rootElement","$timeout","$filter","$q","settings","HR_settings","HRJobRolesService","DateValidation","HRJobRolesServiceFilters","DOMEventTrigger",function(t,a,i,o,s,l,u,c,d,f,p,m,h,b,v){function g(e){return m.createJobRole(e).then(function(e){1===e.is_error?(L.message_type="alert-danger",L.message="Role creation failed!"):(L.message_type="alert-success",L.message="Role added successfully!"),u(function(){L.message=null},3e3)},function(e){t.error=e})}function _(e){return m.getContracts(e).then(function(e){for(var t=[],n={},r=0;r<e.count;r++){t.push(e.values[r].id);var a={id:e.values[r].id,title:e.values[r].title,start_date:e.values[r].period_start_date,end_date:e.values[r].period_end_date,status:status,is_current:e.values[r].is_current,revisions:e.values[r].revisions},i=U(a.end_date)||"Unspecified";a.label=a.title+" ("+U(a.start_date)+" - "+i+")",n[e.values[r].id]=a}return L.contractsData=n,L.job_contract_ids=t,t},function(e){t.error=e})}function $(e){var t=U(e,"YYYY-MM-DD");return"Unspecified"!==t?t:null}function y(e){return m.deleteJobRole(e).then(function(e){1===e.is_error?(L.message_type="alert-danger",L.message="Role delete failure!"):(L.message_type="alert-success",L.message="Role deleted successfully!"),u(function(){L.message=null},3e3)},function(e){t.error=e})}function w(){return r(L.present_job_roles.concat(L.past_job_roles)).map(function(e){return e.funder}).thru(function(e){return e.join("").split("|")}).compact().uniq().value()}function E(e){return L.contractsData[e]}function C(e,n){t.edit_data.hasOwnProperty(e)&&("funders"===n&&(t.edit_data[e][n]=b.issetFunder(t.edit_data[e][n])),"cost_centers"===n&&(t.edit_data[e][n]=b.issetCostCentre(t.edit_data[e][n])))}function D(e,t,n){var n=n?n:{start:"start_date",end:"end_date"};e[n.start]=t.start?U(t.start,Date):null,e[n.end]=t.end?U(t.end,Date):null}function T(){return m.getContactList(null,w()).then(function(e){return r(e.values).map(function(e){return e}).indexBy("contact_id").value()})}function j(e){var t;return t=L.job_contract_ids?d.when(L.job_contract_ids):_(e),t.then(function(e){return!!e.length&&S(e)})}function x(){var n=["hrjc_department","hrjc_region","hrjc_location","hrjc_level_type","cost_centres"];return m.getOptionValues(n).then(function(n){if(1===n.is_error)L.message_type="alert-danger",L.message="Cannot get option values!";else{var r={},a={},i={},o={},s=[];e.forEach(n.optionGroupData,function(e,t){for(var l=0;l<n.count;l++)switch(t){case"hrjc_department":e===n.values[l].option_group_id&&(r[n.values[l].value]={id:n.values[l].value,title:n.values[l].label});break;case"hrjc_region":e===n.values[l].option_group_id&&(a[n.values[l].value]={id:n.values[l].value,title:n.values[l].label});break;case"hrjc_location":e===n.values[l].option_group_id&&(i[n.values[l].value]={id:n.values[l].value,title:n.values[l].label});break;case"hrjc_level_type":e===n.values[l].option_group_id&&(o[n.values[l].value]={id:n.values[l].value,title:n.values[l].label});break;case"cost_centres":e===n.values[l].option_group_id&&s.push({id:n.values[l].value,title:n.values[l].label,weight:n.values[l].weight})}}),L.DepartmentsData=r,L.RegionsData=a,L.LocationsData=i,L.LevelsData=o,t.CostCentreList=s,L.message_type="alert-success",L.message=null}u(function(){L.message=null},3e3)},function(e){t.error=e})}function R(e,t){e.cost_centers=[];for(var n=b.isNotUndefined(t.cost_center.split("|")),r=t.cost_center_val_type.split("|"),a=t.percent_pay_cost_center.split("|"),i=t.amount_pay_cost_center.split("|"),o=0;o<n.length;o++)""!==n[o]&&e.cost_centers.push({id:e.cost_centers.length+1,amount:i[o],cost_centre_id:n[o],percentage:a[o],type:r[o]})}function M(e,t){e.funders=[];for(var n=b.isNotUndefined(t.funder.split("|")),r=t.funder_val_type.split("|"),a=t.percent_pay_funder.split("|"),i=t.amount_pay_funder.split("|"),o=0;o<n.length;o++)""!==n[o]&&e.funders.push({id:e.funders.length+1,amount:i[o],percentage:a[o],type:r[o],funder_id:{id:n[o],sort_name:Y[n[o]].sort_name}})}function k(e,r,a){var i="undefined"==typeof e.start_date||"undefined"==typeof e.job_contract_id;if(e[r]=a,e.start_date){var o=n(e.start_date),s=isNaN(o)&&"undefined"!=typeof e.start_date,l=!("undefined"==typeof e.job_contract_id);s&&l&&i?t.onContractEdited(null,role_id).then(function(){return t.$apply(),t.updateRole(role_id)}):D(e,{start:e.start_date,end:e.end_date})}}function F(e){return null===e}function S(e){return m.getAllJobRoles(e).then(function(e){L.present_job_roles=[],L.past_job_roles=[],L.status="Data load OK",1===e.is_error&&(L.error="Data load failure"),e.values.forEach(function(e){var t=n().startOf("day"),r=null;F(e.end_date)||(r=n(e.end_date).startOf("day")),!r||r.isSameOrAfter(t)?L.present_job_roles.push(e):L.past_job_roles.push(e)})}).then(function(){return T()}).then(function(e){Y=e}).catch(function(e){t.error=e})}function A(e){e.forEach(function(e){var t=e.funder_id;r.contains(Object.keys(Y),t.id)||(Y[t.id]=t)})}function N(e){L.contractsData[e.job_contract_id].is_current&&m.getCurrentDepartments(e.job_contract_id).then(function(e){v("updateContactHeader",{roles:{departments:e}})})}function O(e,n){return m.updateJobRole(e,n).then(function(e){1===e.is_error?(L.message_type="alert-danger",L.message="Role update failed!"):(L.message_type="alert-success",L.message="Role updated successfully!"),u(function(){L.message=null},3e3)},function(e){t.error=e})}function I(e){var n=t.edit_data[e].job_contract_id;if(t.checkIfDatesAreCustom(t.edit_data[e].start_date,t.edit_data[e].end_date)){var r=E(n),a=r.revisions.some(function(n){return n.period_start_date===U(t.edit_data[e].start_date)&&n.period_end_date===U(t.edit_data[e].end_date)});a&&(D(t.edit_data[e],{start:r.start_date,end:r.end_date}),t.updateRole(e))}else D(t.edit_data[e],{start:t.edit_data[e].start_date,end:t.edit_data[e].end_date})}function B(e,t){var n=0;return h.setErrorCallback(function(e,r){n++,r.indexOf("start_date")>-1&&t.start.push(e),r.indexOf("end_date")>-1&&t.end.push(e)}),h.validate(e.start,e.end,e.contractStart,e.contractEnd),0===n}a.debug("Controller: HRJobRolesController");var L=this,U=c("formatDate"),Y={},q=["funders","cost_centers"];t.format=p.DATE_FORMAT,t.loading=!0,t.past_job_roles=[],t.present_job_roles=[],t.collapsedRows=[],t.contactList=[],t.contractsData=[],t.edit_data={},t.view_tab=[],t.CalendarShow=[],t.DepartmentsData={},t.LevelsData={},t.LocationsData={},t.RegionsData={},t.add_new_role_url=t.$parent.pathBaseUrl+t.$parent.pathIncludeTpl+"add_new_role.html",t.job_role_panel_url=t.$parent.pathBaseUrl+t.$parent.pathIncludeTpl+"job_role_panel.html",t.rowTypes={},t.rowTypes[0]={id:0,name:"Fixed"},t.rowTypes[1]={id:1,name:"%"},t.addAdditionalRow=function(e,n){"undefined"==typeof t.edit_data[e]&&(t.edit_data[e]={}),"cost_centre"===n?("undefined"!=typeof t.edit_data[e].cost_centers&&t.edit_data[e].cost_centers instanceof Array||(t.edit_data[e].cost_centers=[]),t.edit_data[e].cost_centers.push({id:t.edit_data[e].cost_centers.length+1,cost_centre_id:"",type:"1",percentage:"0",amount:"0"})):("undefined"!=typeof t.edit_data[e].funders&&t.edit_data[e].funders instanceof Array||(t.edit_data[e].funders=[]),t.edit_data[e].funders.push({id:t.edit_data[e].funders.length+1,funder_id:"",type:"1",percentage:"0",amount:"0"}))},t.add_new_role=function(){t.add_new=!0},t.cancelNewRole=function(){t.add_new=!1,delete t.edit_data.new_role_id},t.checkIfDatesAreCustom=function(t,n){F(t)&&(t=null),F(n)&&(n=null);var r=!0;return!!t&&(e.forEach(L.contractsData,function(e){U(t)===U(e.start_date)&&U(n)===U(e.end_date)&&(r=!1)}),r)},t.changeTab=function(e,n){t.view_tab[e]=n},t.checkNewRole=function(){return"undefined"==typeof t.edit_data.new_role_id||"undefined"==typeof t.edit_data.new_role_id.title||""===t.edit_data.new_role_id.title||"undefined"==typeof t.edit_data.new_role_id.job_contract_id||""===t.edit_data.new_role_id.job_contract_id},t.collapseRow=function(e){t.collapsedRows[e]=!t.collapsedRows[e]},t.deleteAdditionalRow=function(e,n,r){"cost_centre"===n?t.edit_data[e].cost_centers.splice(r,1):t.edit_data[e].funders.splice(r,1)},t.dpOpen=function(e){e.preventDefault(),e.stopPropagation(),t.picker.opened=!0},t.getCostLabel=function(n){var r="";return e.forEach(t.CostCentreList,function(e,t){e.id==n&&(r=e.title)}),r},t.initData=function(e,n,r){"undefined"==typeof t.edit_data[e]&&(t.edit_data[e]={}),"funders"===n?M(t.edit_data[e],r):"cost_centers"===n?R(t.edit_data[e],r):k(t.edit_data[e],n,r),"end_date"!==n||t.edit_data[e].end_date||(t.edit_data[e].end_date=null),t.edit_data[e].job_contract_id&&t.edit_data[e].start_date&&"undefined"!=typeof t.edit_data[e].end_date&&("start_date"===n||"job_contract_id"===n||"end_date"===n)&&I(e)},t.isChanged=function(e){return!!t.edit_data[e].is_edit},t.isOpen=function(e){return!!t.CalendarShow[e]},t.isRowCollapsed=function(e){return!!t.collapsedRows[e]},t.isTab=function(e,n){return t.view_tab[e]==n},t.onAfterSave=function(e,t){C(e,t)},t.onCancel=function(e,t){"both"===t?q.map(function(t){C(e,t)}):C(e,t)},t.onContractEdited=function(e,n){var r=e||t.edit_data[n].job_contract_id,a=E(r),i=t.checkIfDatesAreCustom(t.edit_data[n].start_date,t.edit_data[n].end_date);i?D(t.edit_data[n],{start:t.edit_data[n].start_date,end:t.edit_data[n].end_date}):D(t.edit_data[n],{start:a.start_date,end:a.end_date})},t.onContractSelected=function(){var e=E(t.edit_data.new_role_id.job_contract_id),n=t.checkIfDatesAreCustom(t.edit_data.new_role_id.newStartDate,t.edit_data.new_role_id.newEndDate);D(t.edit_data.new_role_id,{start:n?t.edit_data.new_role_id.newStartDate:e.start_date,end:n?t.edit_data.new_role_id.newEndDate:e.end_date},{start:"newStartDate",end:"newEndDate"})},t.open=function(e){t.CalendarShow[e]=!0},t.removeRole=function(e){a.debug("Remove Role");var n=s.open({appendTo:l.find("div").eq(0),template:"",templateUrl:f.pathApp+"views/modalDialog.html?v="+(new Date).getTime(),size:"sm",controller:"ModalDialogCtrl",resolve:{content:function(){return{copyCancel:"No",title:"Alert",msg:"Are you sure you want to Delete Job Role?"}}}});n.result.then(function(n){n&&y(e.id).then(function(){return N(e),j(t.$parent.contactId)})})},t.saveNewRole=function(){var n;a.debug("Add New Role"),t.errors={},t.errors.newStartDate=[],t.errors.newEndDate=[];var r=E(t.edit_data.new_role_id.job_contract_id),i=B({start:t.edit_data.new_role_id.newStartDate,end:t.edit_data.new_role_id.newEndDate,contractStart:r.start_date,contractEnd:r.end_date},{start:t.errors.newStartDate,end:t.errors.newEndDate});i&&(n=e.copy(t.edit_data.new_role_id),n.newStartDate=$(n.newStartDate),n.newEndDate?n.newEndDate=$(n.newEndDate):delete n.newEndDate,n.funders&&n.funders.length&&A(n.funders),g(n).then(function(){return N(n),t.add_new=!1,delete t.edit_data.new_role_id,j(t.$parent.contactId)}))},t.select=function(e){t.CalendarShow[e]=!1},t.showRowType=function(e){var n="";return"undefined"!=typeof e.type?(n=t.rowTypes[e.type],n.name):"Not set"},t.showSave=function(e){t.edit_data[e].is_edit=!0},t.today=function(){t.CalendarShow.newStartDate=!1,t.CalendarShow.newEndDate=!1,t.CalendarShow.start_date=!1,t.CalendarShow.end_date=!1},t.updateAdditionalRowType=function(e,n,r,a){"cost_centre"===n?t.edit_data[e].cost_centers[r].type=a:t.edit_data[e].funders[r].type=a},t.updateRole=function(n,r){var i;a.debug("Update Role"),"string"==typeof r&&C(n,r),i=e.copy(t.edit_data[n]),i.start_date=$(i.start_date),i.end_date?i.end_date=$(i.end_date):delete i.end_date,i.funders&&i.funders.length&&A(i.funders),O(n,i).then(function(){return N(i),j(t.$parent.contactId)})},t.validateRole=function(e){e.start_date.$error.custom=[],e.end_date.$error.custom=[];var t=E(e.contract.$viewValue),n=B({start:e.start_date.$viewValue,end:e.end_date.$viewValue,contractStart:t.start_date,contractEnd:t.end_date},{start:e.start_date.$error.custom,end:e.end_date.$error.custom});return!!n||"Error"},t.validateTitle=function(e){if("title"===e||" "===e)return"Title cannot be title!"},L.getContactList=function(e){var n=function(e){var t=[],n=0;if(1===e.is_error)L.message_type="alert-danger",L.message="Cannot get contact list!";else{for(;n<e.count;n++)t.push({id:e.values[n].id,sort_name:e.values[n].sort_name});L.contactList=t}u(function(){L.message=null},3e3)},r=function(e){t.error=e};return m.getContactList(e).then(n,r)},function(){t.today(),d.all([x(),j(t.$parent.contactId),L.getContactList()]).then(function(){t.loading=!1})}()}])}),define("job-roles/controllers/modal-dialog",["job-roles/controllers/controllers"],function(e){"use strict";e.controller("ModalDialogCtrl",["$scope","$uibModalInstance","$timeout","content","$log",function(e,t,n,r,a){a.debug("Controller: ModalDialogCtrl"),e.title=r.title||"CiviHR Job Roles",e.msg=r.msg||"",e.copyConfirm=r.copyConfirm||"Yes",e.copyCancel=r.copyCancel||"Cancel",e.confirm=function(e){t.close(e||!0)},e.cancel=function(){t.dismiss("Cancel")}}])}),define("job-roles/services/hr-job-roles-service",["common/lodash","job-roles/services/services"],function(e,t){"use strict";t.factory("HRJobRolesService",["$log","$q","$filter",function(t,n,r){function a(t){var n=t["api.HRJobContractRevision.get"].values;delete t["api.HRJobContractRevision.get"],t.revisions=e.compact(n.map(function(e){var n=e["api.HRJobDetails.getsingle"];return n.period_start_date===t.period_start_date&&n.period_end_date===t.period_end_date?null:(n.period_start_date=r("formatDate")(n.period_start_date),n.period_end_date=r("formatDate")(n.period_end_date),n)}))}return{getContracts:function(e){var t=n.defer();return CRM.api3("HRJobContract","get",{sequential:1,contact_id:e,deleted:0,return:"title,period_end_date,period_start_date","api.HRJobContractRevision.get":{jobcontract_id:"$value.id","api.HRJobDetails.getsingle":{jobcontract_revision_id:"$value.id"}}}).done(function(e){e.values.forEach(a),t.resolve(e)}).error(function(){t.reject("An error occured while fetching items")}),t.promise},getAllJobRoles:function(e){var t=n.defer();return CRM.api3("HrJobRoles","get",{sequential:1,return:"id,job_contract_id,title,description,status,funder,funder_val_type,percent_pay_funder,amount_pay_funder,cost_center,cost_center_val_type,percent_pay_cost_center,amount_pay_cost_center,level_type,location,region,department,end_date,start_date",job_contract_id:{IN:e}}).done(function(e){t.resolve(e)}).error(function(e){t.reject("An error occured while fetching items")}),t.promise},deleteJobRole:function(e){var t=n.defer();return CRM.api3("HrJobRoles","delete",{sequential:1,id:e}).done(function(e){t.resolve(e)}).error(function(e){t.reject("An error occured while deleting items");
}),t.promise},createJobRole:function(e){var t="|",r="|",a="|",i="|",o="|",s="|",l="|",u="|";if("undefined"!=typeof e.funders)for(var c=0,d=e.funders.length;c<d;c++)e.funders[c]&&(t+=e.funders[c].funder_id.id+"|",r+=e.funders[c].type+"|",a+=e.funders[c].percentage+"|",i+=e.funders[c].amount+"|");if("undefined"!=typeof e.cost_centers)for(c=0,d=e.cost_centers.length;c<d;c++)e.cost_centers[c]&&(o+=e.cost_centers[c].cost_centre_id+"|",s+=e.cost_centers[c].type+"|",l+=e.cost_centers[c].percentage+"|",u+=e.cost_centers[c].amount+"|");var f=n.defer();return this.getNewJobRole(e.job_contract_id).then(function(n){return CRM.api3("HrJobRoles","update",{id:n.id,sequential:1,job_contract_id:e.job_contract_id,title:e.title,description:e.description,funder:t,funder_val_type:r,percent_pay_funder:a,amount_pay_funder:i,cost_center:o,cost_center_val_type:s,percent_pay_cost_center:l,amount_pay_cost_center:u,level_type:e.level,location:e.location,region:e.region,department:e.department,start_date:e.newStartDate,end_date:e.newEndDate||null})}).then(function(e){f.resolve(e)},function(e){f.reject("An error occured while adding items")}),f.promise},updateJobRole:function(e,t){var r="|",a="|",i="|",o="|",s="|",l="|",u="|",c="|";if("undefined"!=typeof t.funders)for(var d=0,f=t.funders.length;d<f;d++)t.funders[d]&&(r+=t.funders[d].funder_id.id+"|",a+=t.funders[d].type+"|",i+=t.funders[d].percentage+"|",o+=t.funders[d].amount+"|");if("undefined"!=typeof t.cost_centers)for(var d=0,f=t.cost_centers.length;d<f;d++)t.cost_centers[d]&&(s+=t.cost_centers[d].cost_centre_id+"|",l+=t.cost_centers[d].type+"|",u+=t.cost_centers[d].percentage+"|",c+=t.cost_centers[d].amount+"|");var p=n.defer();return CRM.api3("HrJobRoles","create",{sequential:1,id:e,job_contract_id:t.job_contract_id,title:t.title,description:t.description,status:t.status,funder:r,funder_val_type:a,percent_pay_funder:i,amount_pay_funder:o,cost_center:s,cost_center_val_type:l,percent_pay_cost_center:u,amount_pay_cost_center:c,level_type:t.level,location:t.location,region:t.region,start_date:t.start_date,end_date:t.end_date||0,department:t.department}).done(function(e){p.resolve(e)}).error(function(e){p.reject("An error occured while updating items")}),p.promise},getContactList:function(t,r){var a=n.defer();return CRM.api3("Contact","get",{sequential:1,return:"id, sort_name",id:e.isArray(r)?{IN:r}:null,sort_name:t||null}).done(function(e){a.resolve(e)}).error(function(e){a.reject("An error occured while fetching items")}),a.promise},getOptionValues:function(t){var r=n.defer();return CRM.api3("OptionValue","get",{sequential:1,"option_group_id.name":{IN:t},return:["id","label","weight","value","option_group_id","option_group_id.name"],options:{limit:1e3,sort:"id"}}).done(function(t){t.optionGroupData=e(t.values).map(function(e){return[e["option_group_id.name"],e.option_group_id]}).zipObject().value(),r.resolve(t)}).error(function(e){r.reject("An error occured while fetching items")}),r.promise},getNewJobRole:function(e){return CRM.api3("HrJobRoles","create",{sequential:1,job_contract_id:e,title:""})},getCurrentDepartments:function(e){return CRM.api3("HrJobRoles","getcurrentdepartments",{sequential:1,job_contract_id:e}).then(function(e){return e.values})}}}])}),define("job-roles/services/date-validation",["job-roles/services/services","common/moment"],function(e,t){e.factory("DateValidation",["HR_settings",function(e){function n(e,t){e.isValid()||l("Date is not valid!!",t)}function r(e,t){e.isSameOrAfter(t)&&l("Start Date cannot be the same as or after the End Date.",["start_date","end_date"])}function a(e,t){e.isBefore(t)&&l("Start Date cannot be lower than Contract Start Date.",["start_date"])}function i(e,t){e.isAfter(t)&&l("Start Date cannot be higher than Contract End Date.",["start_date"])}function o(e,t){e.isAfter(t)&&l("End Date cannot be higher than Contract End Date.",["end_date"])}function s(e,n){return e instanceof Date&&(e=t(e).valueOf()),t(e,n,!0).startOf("day")}var l=function(e,t){throw new Error(e,t[0])},u={dateFormats:["x","YYYY-MM-DD"],setErrorCallback:function(e){if("function"!=typeof e)throw new TypeError("Error callback must be a function.");l=e},validate:function(e,t,l,u){e=s(e,this.dateFormats),l=s(l,this.dateFormats),u=s(u,this.dateFormats),n(e,["start_date"]),i(e,u),a(e,l),(0===t||t)&&(t=s(t,this.dateFormats),n(t,["end_date"]),o(t,u),r(e,t))}};return e.DATE_FORMAT&&u.dateFormats.push(e.DATE_FORMAT.toUpperCase()),u}])}),define("job-roles/services/hr-job-roles-service-filter",["job-roles/services/services"],function(e){"use strict";e.factory("HRJobRolesServiceFilters",function(){return{isNotUndefined:function(e){try{return e.constructor===Array?e.filter(function(e){return"undefined"!==e&&void 0!==e}):e}catch(t){return e}},issetCostCentre:function(e){try{return e.constructor===Array?e.filter(function(e){return""!==e.cost_centre_id&&("1"===e.type&&parseInt(e.percentage)>0||"0"===e.type&&parseInt(e.amount)>0)}):e}catch(t){return e}},issetFunder:function(e){try{return e.constructor===Array?e.filter(function(e){return""!==e.funder_id&&("1"===e.type&&parseInt(e.percentage)>0||"0"===e.type&&parseInt(e.amount)>0)}):e}catch(t){return e}}}})}),define("job-roles/directives/example",["job-roles/directives/directives"],function(e){"use strict";e.directive("example",["$rootScope","$log",function(e,t){return t.debug("Directive: example"),{link:function(e,t,n){}}}])}),define("job-roles/app",["common/ui-select","common/services/angular-date/date-format","common/services/dom-event-trigger","common/modules/routers/compu-ng-route","common/modules/directives","common/directives/angular-date/date-input","job-roles/vendor/angular-editable","job-roles/vendor/angular-filter","job-roles/controllers/controllers","job-roles/directives/directives","job-roles/filters/filters","job-roles/services/services","job-roles/controllers/hr-job-roles-controller","job-roles/controllers/modal-dialog","job-roles/services/hr-job-roles-service","job-roles/services/date-validation","job-roles/services/hr-job-roles-service-filter","job-roles/directives/example"],function(){"use strict";angular.module("hrjobroles",["ngAnimate","ngSanitize","ngResource","common.angularDate","common.services","common.directives","compuNgRoute","xeditable","angular.filter","ui.bootstrap","ui.select","hrjobroles.controllers","hrjobroles.directives","hrjobroles.filters","hrjobroles.services"]).constant("settings",{classNamePrefix:"hrjobroles-",contactId:decodeURIComponent((new RegExp("[?|&]cid=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null,debug:!0,pathApp:CRM.vars.hrjobroles.path,pathRest:CRM.url("civicrm/ajax/rest"),pathBaseUrl:CRM.vars.hrjobroles.baseURL+"/",pathTpl:"views/",pathIncludeTpl:"views/include/"}).config(["settings","$routeProvider","$resourceProvider","$httpProvider","$logProvider",function(e,t,n,r,a){a.debugEnabled(e.debug),t.resolveForAll({format:["DateFormat",function(e){return e.getDateFormat()}]}).when("/",{templateUrl:e.pathBaseUrl+e.pathTpl+"mainTemplate.html?v=1",resolve:{},controller:"HRJobRolesController",controllerAs:"jobroles"}).otherwise({redirectTo:"/"}),n.defaults.stripTrailingSlashes=!1,r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]).run(["settings","$rootScope","$q","$log","editableOptions",function(e,t,n,r,a){r.debug("app.run"),a.theme="bs3",t.contactId=e.contactId,t.pathBaseUrl=e.pathBaseUrl,t.pathTpl=e.pathTpl,t.pathIncludeTpl=e.pathIncludeTpl,t.prefix=e.classNamePrefix}])}),function(e,t){var n=e.vars.hrjobroles.baseURL+"/js/src/job-roles";t.config({paths:{"job-roles":n,"job-roles/vendor/angular-editable":n+"/vendor/angular-xeditable/dist/js/xeditable.min","job-roles/vendor/angular-filter":n+"/vendor/angular-filter/dist/angular-filter.min"}}),t(["job-roles/app"],function(e){"use strict";document.dispatchEvent("function"==typeof window.CustomEvent?new CustomEvent("hrjobrolesReady"):function(){var e=document.createEvent("Event");return e.initEvent("hrjobrolesReady",!0,!0),e}())})}(CRM,require);